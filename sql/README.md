# ë°ì´í„°ë² ì´ìŠ¤

ì²´ê³„ì ì¸ ë°ì´í„° ëª¨ìŒ

## ë°ì´í„°

ì €ì¥ì´ë‚˜ ì²˜ë¦¬ì— íš¨ìœ¨ì ì¸ í˜•íƒœë¡œ ë³€í™˜ëœ ì •ë³´

### ê¸°ì¡´ì˜ ë°ì´í„° ì €ì¥ ë°©ì‹

- íŒŒì¼ ì´ìš©
    - ì–´ë””ì—ì„œë‚˜ ì‰½ê²Œ ì‚¬ìš© ê°€ëŠ¥
    - ë°ì´í„°ë¥¼ êµ¬ì¡°ì ìœ¼ë¡œ ê´€ë¦¬í•˜ê¸° ì–´ë ¤ì›€
- ìŠ¤í”„ë ˆë“œ ì‹œíŠ¸ë¥¼ ì´ìš©
    - í…Œì´ë¸”ì˜ ì—´ê³¼ í–‰ì„ ì‚¬ìš©í•´ ë°ì´í„°ë¥¼ êµ¬ì¡°ì ìœ¼ë¡œ ê´€ë¦¬ ê°€ëŠ¥
    - ìŠ¤í”„ë ˆë“œ ì‹œíŠ¸ì˜ í•œê³„
        1. í¬ê¸°
            - ì¼ë°˜ì ìœ¼ë¡œ ì•½ 100ë§Œ í–‰ê¹Œì§€ë§Œ ì €ì¥ ê°€ëŠ¥
        2. ë³´ì•ˆ
            - ë‹¨ìˆœíˆ íŒŒì¼ì´ë‚˜ ë§í¬ ì†Œìœ  ì—¬ë¶€ì— ë”°ë¥¸ ë‹¨ìˆœí•œ ì ‘ê·¼ ê¶Œí•œ ê¸°ëŠ¥ ì œê³µ
        3. ì •í™•ì„±
            1. ë§Œì•½ ê³µì‹ì ìœ¼ë¡œ ê°•ì›ì˜ ì§€ëª…ì´ ê°•ì–¸ìœ¼ë¡œ ë°”ë€Œì—ˆë‹¤ê³  ê°€ì •í•œë‹¤ë©´?
            2. ì´ ë³€ê²½ìœ¼ë¡œ ì¸í•´ í…Œì´ë¸” ëª¨ë“  ìœ„ì¹˜ì—ì„œ í•´ë‹¹ ê°’ì„ ì—…ë°ì´íŠ¸ í•´ì•¼ í•¨
            3. ì°¾ê¸° ë° ë°”ê¾¸ê¸° ê¸°ëŠ¥ì„ ì‚¬ìš©í•´ ë°”ê¿€ ìˆ˜ ìˆì§€ë§Œ ë§Œì•½ ë°ì´í„°ê°€ ì—¬ëŸ¬ ì‹œíŠ¸ì— ë¶„ì‚°ë˜ì–´ ìˆë‹¤ë©´ ë³€ê²½ì— ëˆ„ë½ì´ ìƒê¸°ê±°ë‚˜ ì¶”ê°€ ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆìŒ

### ë°ì´í„°ë² ì´ìŠ¤ì˜ ì—­í• 

ë°ì´í„°ë¥¼ ì €ì¥í•˜ê³  ì¡°ì‘ 

## Relational Database(ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤)

- ë°ì´í„° ê°„ì— ê´€ê³„ê°€ ìˆëŠ” ë°ì´í„° í•­ëª©ë“¤ì˜ ëª¨ìŒ
- í…Œì´ë¸”, í–‰, ì—´ì˜ ì •ë³´ë¥¼ êµ¬ì¡°í™”í•˜ëŠ” ë°©ì‹
- ì„œë¡œ ê´€ë ¨ëœ ë°ì´í„° í¬ì¸í„°ë¥¼ ì €ì¥í•˜ê³  ì´ì— ëŒ€í•œ ì•¡ì„¸ìŠ¤ë¥¼ ì œê³µ
- `ê´€ê³„` : ì—¬ëŸ¬ í…Œì´ë¸” ê°„ì˜ (ë…¼ë¦¬ì ) ì—°ê²°
- ì´ ê´€ê³„ë¡œ ì¸í•´ ë‘ í…Œì´ë¸”ì„ ì‚¬ìš©í•˜ì—¬ ë°ì´í„°ë¥¼ ë‹¤ì–‘í•œ í˜•ì‹ìœ¼ë¡œ ì¡°íšŒí•  ìˆ˜ ìˆìŒ
    - íŠ¹ì • ë‚ ì§œì— êµ¬ë§¤í•œ ëª¨ë“  ê³ ê° ì¡°íšŒ
    - ì§€ë‚œ ë‹¬ì— ë°°ì†¡ì¼ì´ ì§€ì—°ëœ ê³ ê° ì¡°íšŒ

### ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ ì˜ˆì‹œ

- ê³ ê° í…Œì´ë¸”ì—ì„œ ê³ ê° ë°ì´í„° ê°„ ë¹„êµë¥¼ í•˜ê¸° ìœ„í•´ì„œ ì–´ë–»ê²Œ í•´ì•¼ í•˜ëŠ”ê°€?
    
    
    | ì´ë¦„ | ì²­êµ¬ì§€ | ì£¼ì†Œì§€ |
    | --- | --- | --- |
    | ê¹€í•œì›… | ì„œìš¸ | ê°•ì› |
    | ë°•ì§€ìˆ˜ | ê²½ê¸° | ì„œìš¸ |
    - ê³ ìœ í•œ ì‹ë³„ ê°’ì„ ë¶€ì—¬í•˜ê¸°(ê¸°ë³¸ í‚¤, Primary Key)
        
        
        | id | ì´ë¦„ | ì²­êµ¬ì§€ | ì£¼ì†Œì§€ |
        | --- | --- | --- | --- |
        | 1 | ê¹€í•œì›… | ì„œìš¸ | ê°•ì› |
        | 2 | ë°•ì§€ìˆ˜ | ê²½ê¸° | ì„œìš¸ |
- ì£¼ë¬¸ í…Œì´ë¸”, ê³ ê° í…Œì´ë¸”ì´ ì¡´ì¬í•  ë•Œ ëˆ„ê°€ ì–´ë–¤ ì£¼ë¬¸ì„ í–ˆëŠ”ì§€ ì–´ë–»ê²Œ ì‹ë³„í• ê²ƒì¸ê°€?
    
    
    | id | ì£¼ë¬¸ì¼ | ì£¼ë¬¸ ìƒíƒœ |
    | --- | --- | --- |
    | 1 | 2002/01/01 | ë°°ì†¡ ì™„ë£Œ |
    | 2 | 2002/03/04 | ìƒí’ˆ ì¤€ë¹„ì¤‘ |
    
    | id | ì´ë¦„ | ì²­êµ¬ì§€ | ì£¼ì†Œì§€ |
    | --- | --- | --- | --- |
    | 1 | ê¹€í•œì›… | ì„œìš¸ | ê°•ì› |
    | 2 | ë°•ì§€ìˆ˜ | ê²½ê¸° | ì„œìš¸ |
    - ê³ ê°ì˜ ê³ ìœ í•œ ì‹ë³„ ê°’ì„ ì €ì¥(ì™¸ë˜ í‚¤, Foreign Key)
        
        
        | id | ì£¼ë¬¸ì¼ | ì£¼ë¬¸ ìƒíƒœ | ê³ ê° id |
        | --- | --- | --- | --- |
        | 1 | 2002/01/01 | ë°°ì†¡ ì™„ë£Œ | 2 |
        | 2 | 2002/03/04 | ìƒí’ˆ ì¤€ë¹„ì¤‘ | 1 |

### ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ ê´€ë ¨ í‚¤ì›Œë“œ

#### Table(Relation)

- í–‰ê³¼ ì—´ì„ ì‚¬ìš©í•˜ì—¬ ë°ì´í„°ë¥¼ ê¸°ë¡í•˜ëŠ” ê³³

#### Field(Column, Attribute)

- ê° í•„ë“œì—ëŠ” ê³ ìœ í•œ ë°ì´í„° í˜•ì‹(íƒ€ì…)ì´ ì§€ì •ë¨

#### Record(Row, Tuple)

- ê° ë ˆì½”ë“œì—ëŠ” êµ¬ì²´ì ì¸ ë°ì´í„° ê°’ì´ ì €ì¥ë¨

#### Database(Schema)

- í…Œì´ë¸”ì˜ ì§‘í•©

#### Primary Key(ê¸°ë³¸ í‚¤)

- ê° ë ˆì½”ë“œì˜ ê³ ìœ í•œ ê°’
- ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ë ˆì½”ë“œì˜ ì‹ë³„ìë¡œ í™œìš©

#### Foreign Key(ì™¸ë˜ í‚¤)

- í…Œì´ë¸”ì˜ í•„ë“œ ì¤‘ ë‹¤ë¥¸ í…Œì´ë¸”ì˜ ë ˆì½”ë“œë¥¼ ì‹ë³„í•  ìˆ˜ ìˆëŠ” í‚¤
- ë‹¤ë¥¸ í…Œì´ë¸”ì˜ ê¸°ë³¸ í‚¤ë¥¼ ì°¸ì¡°
- ê° ë ˆì½”ë“œì—ì„œ ì„œë¡œ ë‹¤ë¥¸ í…Œì´ë¸” ê°„ì˜ ê´€ê³„ë¥¼ ë§Œë“œëŠ” ë° ì‚¬ìš©

## DBMS(Database Management System)

- ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ê´€ë¦¬í•˜ëŠ” ì†Œí”„íŠ¸ì›¨ì–´ í”„ë¡œê·¸ë¨
- ë°ì´í„° ì €ì¥ ë° ê´€ë¦¬ë¥¼ ìš©ì´í•˜ê²Œ í•˜ëŠ” ì‹œìŠ¤í…œ
- ë°ì´í„°ë² ì´ìŠ¤ì™€ ì‚¬ìš©ì ê°„ì˜ ì¸í„°í˜ì´ìŠ¤ ì—­í• 
- ì‚¬ìš©ìê°€ ë°ì´í„° êµ¬ì„±, ì—…ë°ì´íŠ¸, ëª¨ë‹ˆí„°ë§, ë°±ì—…, ë³µêµ¬ ë“±ì„ í•  ìˆ˜ ìˆë„ë¡ ë„ì›€

### RDBMS(Relational Database Management System)

- ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ê´€ë¦¬í•˜ëŠ” ì†Œí”„íŠ¸ì›¨ì–´ í”„ë¡œê·¸ë¨
    - SQLite
        - ê²½ëŸ‰ì˜ ì˜¤í”ˆ ì†ŒìŠ¤ ë°ì´í„°ë² ì´ìŠ¤ ê´€ë¦¬ ì‹œìŠ¤í…œ
        - ì»´í“¨í„°ë‚˜ ëª¨ë°”ì¼ ê¸°ê¸°ì— ë‚´ì¥ë˜ì–´ ê°„ë‹¨í•˜ê³  íš¨ìœ¨ì ì¸ ë°ì´í„° ì €ì¥ ë° ê´€ë¦¬ë¥¼ ì œê³µ
    - MySQL
    - PostgreSQL
    - Oracle Database

# SQL(Structure Query Language)

- ë°ì´í„°ë² ì´ìŠ¤ì— ì •ë³´ë¥¼ ì €ì¥í•˜ê³  ì²˜ë¦¬í•˜ê¸° ìœ„í•œ í”„ë¡œê·¸ë˜ë° ì–¸ì–´
- í…Œì´ë¸”ì˜ í˜•íƒœë¡œ êµ¬ì¡°í™”ëœ ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ì—ê²Œ ìš”ì²­ì„ ì§ˆì˜(ìš”ì²­)
- ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ì™€ì˜ ëŒ€í™œë¥´ ìœ„í•´ ì‚¬ìš©í•˜ëŠ” í”„ë¡œê·¸ë˜ë° ì–¸ì–´

## SQL í‘œì¤€

- SQLì€ ë¯¸êµ­ êµ­ë¦½ í‘œì¤€ í˜‘íšŒ(ANSI)ì™€ êµ­ì œ í‘œì¤€í™” ê¸°êµ¬(ISO)ì— ì˜í•´ í‘œì¤€ì´ ì±„íƒë¨
- ëª¨ë“  RDBMSì—ì„œ SQL í‘œì¤€ì„ ì§€ì›
- ë‹¤ë§Œ ê° RDBMSë§ˆë‹¤ ë…ìì ì¸ ê¸°ëŠ¥ì— ë”°ë¼ í‘œì¤€ì„ ë²—ì–´ë‚˜ëŠ” ë¬¸ë²•ì´ ì¡´ì¬í•˜ë‹ˆ ì£¼ì˜

## SQL Syntax

```sql
SELECT column_name FROM table_name;
```

- SQL í‚¤ì›Œë“œëŠ” ëŒ€ì†Œë¬¸ìë¥¼ êµ¬ë¶„í•˜ì§€ ì•ŠìŒ
    - í•˜ì§€ë§Œ ëŒ€ë¬¸ìë¡œ ì‘ì„±í•˜ëŠ” ê²ƒì„ ê¶Œì¥(ëª…ì‹œì  êµ¬ë¶„)
- ê° SQL Statementsì˜ ëì—ëŠ” ì„¸ë¯¸ì½œë¡ (;)ì´ í•„ìš”
    - ì„¸ë¯¸ì½œë¡ ì€ ê° SQL Statementsë¥¼ êµ¬ë¶„í•˜ëŠ” ë°©ë²•(ëª…ë ¹ì–´ì˜ ë§ˆì¹¨í‘œ)

## SQL Statements

- SQLì„ êµ¬ì„±í•˜ëŠ” ê°€ì¥ ê¸°ë³¸ì ì¸ ì½”ë“œ ë¸”ë¡
- ì˜ˆì‹œ
    
    ```sql
    SELECT column_name FROM table_name;
    ```
    
    - í•´ë‹¹ ì˜ˆì‹œ ì½”ë“œëŠ” SELECT Statementsë¼ ë¶€ë¦„
    - ì´ StatementëŠ” SELECT, FROM 2ê°œì˜ keywordë¡œ êµ¬ì„±ë¨
- ìˆ˜í–‰ ëª©ì ì— ë”°ë¼ 4ê°€ì§€ ìœ í˜•ìœ¼ë¡œ ë‚˜ë‰¨
    
    
    | ìœ í˜• | ì—­í•  | SQL í‚¤ì›Œë“œ |
    | --- | --- | --- |
    | DDL(Data Definition Language) | ë°ì´í„°ì˜ ê¸°ë³¸ êµ¬ì¡° ë° í˜•ì‹ ë³€ê²½ | CREATE, DROP, ALTER |
    | DQL(Data Query Language) | ë°ì´í„° ê²€ìƒ‰ | SELECT |
    | DML(Data Manipulation Language) | ë°ì´í„° ì¡°ì‘(ì¶”ê°€, ìˆ˜ì •, ì‚­ì œ) | INSERT, UPDATE, DELETE |
    | DCL(Data Control Language) | ë°ì´í„° ë° ì‘ì—…ì— ëŒ€í•œ ì‚¬ìš©ì ê¶Œí•œ ì œì–´ | COMMIT, ROLLBACK |

`Query`

- ë°ì´í„°ë² ì´ìŠ¤ë¡œë¶€í„° ì •ë³´ë¥¼ ìš”ì²­í•˜ëŠ” ê²ƒ
- ì¼ë°˜ì ìœ¼ë¡œ SQLë¡œ ì‘ì„±í•˜ëŠ” ì½”ë“œë¥¼ ì¿¼ë¦¬ë¬¸(SQLë¬¸)ì´ë¼ í•¨

## Querying data(DQL)

### SELECT

- í…Œì´ë¸”ì—ì„œ ë°ì´í„°ë¥¼ ì¡°íšŒ

```sql
SELECT
	select_list
FROM
	table_name;
```

- SELECT í‚¤ì›Œë“œ ì´í›„ ë°ì´í„°ë¥¼ ì„ íƒí•˜ë ¤ëŠ” í•„ë“œë¥¼ í•˜ë‚˜ ì´ìƒ ì§€ì •
- FROM í‚¤ì›Œë“œ ì´í›„ ë°ì´í„°ë¥¼ ì„ íƒí•˜ë ¤ëŠ” í…Œì´ë¸”ì˜ ì´ë¦„ì„ ì§€ì •
- ì˜ˆì‹œ
    - í…Œì´ë¸” employeesì—ì„œ LastName í•„ë“œì˜ ëª¨ë“  ë°ì´í„°ë¥¼ ì¡°íšŒ
    
    ```sql
    SELECT
    	LastName
    FROM
    	employees;
    ```
    
    - í…Œì´ë¸” employeesì—ì„œ LastName, FirstName í•„ë“œì˜ ëª¨ë“  ë°ì´í„° ì¡°íšŒ
    
    ```sql
    SELECT 
      LastName, FirstName
    FROM
      employees;
    ```
    
    - í…Œì´ë¸” employeesì—ì„œ ëª¨ë“  í•„ë“œ ë°ì´í„°ë¥¼ ì¡°íšŒ
    
    ```sql
    # *(asterisk)ë¥¼ ì‚¬ìš©í•˜ì—¬ ëª¨ë“  í•„ë“œ ì„ íƒ
    SELECT
      *
    FROM
      employees;
    ```
    
    - í…Œì´ë¸” employeesì—ì„œ FirstName í•„ë“œì˜ ëª¨ë“  ë°ì´í„°ë¥¼ ì¡°íšŒ(ë‹¨, ì¡°íšŒ ì‹œ FirstNameì´ ì•„ë‹Œ â€˜ì´ë¦„â€™ìœ¼ë¡œ ì¶œë ¥ ë  ìˆ˜ ìˆë„ë¡ ë³€ê²½)
    
    ```sql
    SELECT
      FirstName as ì´ë¦„
    FROM
      employees;
    ```
    
    - í…Œì´ë¸” tracksì—ì„œ Name, Milliseconds í•„ë“œì˜ ëª¨ë“  ë°ì´í„° ì¡°íšŒ(ë‹¨, Millisecondsí•„ë“œëŠ” 60000ìœ¼ë¡œ ë‚˜ëˆ  ë¶„ ë‹¨ìœ„ ê°’ìœ¼ë¡œ ì¶œë ¥)
    
    ```sql
    SELECT
      Name, Milliseconds/60000 AS 'ì¬ìƒ ì‹œê°„(ë¶„)'
    FROM
      tracks;
    ```
    

## Sorting data(DQL)

### ORDER BY

- ì¡°íšŒ ê²°ê³¼ì˜ ë ˆì½”ë“œë¥¼ ì •ë ¬

```sql
SELECT
	select_list
FROM
	table_name
ORDER BY
	column1 [ASC|DESC],
	column2 [ASC|DESC],
	...;
```

- FROM clause ë’¤ì— ìœ„ì¹˜
- í•˜ë‚˜ ì´ìƒì˜ ì»¬ëŸ¼ì„ ê¸°ì¤€ìœ¼ë¡œ ê²°ê³¼ë¥¼ ì˜¤ë¦„ì°¨ìˆœ(ASC, default), ë‚´ë¦¼ì°¨ìˆœ(DESC)ìœ¼ë¡œ ì •ë ¬
- ì˜ˆì‹œ
    - í…Œì´ë¸” employeesì—ì„œ FirstName í•„ë“œì˜ ëª¨ë“  ë°ì´í„°ë¥¼ ì˜¤ë¦„ì°¨ìˆœìœ¼ë¡œ ì¡°íšŒ
    
    ```sql
    SELECT
      FirstName
    FROM
      employees
    ORDER BY
      FirstName;
    ```
    
    - í…Œì´ë¸” employeesì—ì„œ FirstName í•„ë“œì˜ ëª¨ë“  ë°ì´í„°ë¥¼ ë‚´ë¦¼ì°¨ìˆœìœ¼ë¡œ ì¡°íšŒ
    
    ```sql
    SELECT
      FirstName
    FROM
      employees
    ORDER BY
      FirstName DESC;
    ```
    
    - í…Œì´ë¸” customersì—ì„œ Country í•„ë“œë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë‚´ë¦¼ì°¨ìˆœìœ¼ë¡œ ì •ë ¬ í•œ ë‹¤ìŒ City í•„ë“œ ê¸°ì¤€ìœ¼ë¡œ ì˜¤ë¦„ì°¨ìˆœ ì •ë ¬í•˜ì—¬ ì¡°íšŒ
    
    ```sql
    SELECT
      Country, City
    FROM
      customers
    ORDER BY
      Country DESC,
      City;
    ```
    
    - í…Œì´ë¸” tracksì—ì„œ Milliseconds í•„ë“œë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë‚´ë¦¼ì°¨ìˆœìœ¼ë¡œ ì •ë ¬í•œ ë‹¤ìŒ Name, Milliseconds í•„ë“œì˜ ëª¨ë“  ë°ì´í„°ë¥¼ ì¡°íšŒ(ë‹¨, Milliseconds í•„ë“œëŠ” 60000ìœ¼ë¡œ ë‚˜ëˆ  ë¶„ ë‹¨ìœ„ ê°’ìœ¼ë¡œ ì¶œë ¥)
    
    ```sql
    SELECT
      Name, Milliseconds/60000 AS 'ì¬ìƒ ì‹œê°„(ë¶„)'
    FROM
      tracks
    ORDER BY
      Milliseconds DESC;
    ```
    

### ì •ë ¬ì—ì„œì˜ NULL

- NULL ê°’ì´ ì¡´ì¬í•  ê²½ìš°, ì˜¤ë¦„ì°¨ìˆœ ì •ë ¬ ì‹œ ê²°ê³¼ì— NULLì´ ë¨¼ì € ì¶œë ¥

![Untitled](https://github.com/yuj1818/TIL/assets/95585314/6f91b238-6c07-4d4c-b581-ae1bd3efa0e0)

### SELECT statement ì‹¤í–‰ ìˆœì„œ

- í…Œì´ë¸”ì—ì„œ(FROM) â†’ ì¡°íšŒí•˜ì—¬(SELECT) â†’ ì •ë ¬(ORDER BY)

## Filtering data(DQL)

- ê´€ë ¨ Keywords
    - Clause
        - DISTINCT
        - WHERE
        - LIMIT
    - Operator
        - BETWEEN
        - IN
        - LIKE
        - Comparison
        - Logical

### DISTINCT

- ì¡°íšŒ ê²°ê³¼ì—ì„œ ì¤‘ë³µëœ ë ˆì½”ë“œë¥¼ ì œê±°

```sql
SELECT DISTINCT
	select_list
FROM
	table_name;
```

- SELECT í‚¤ì›Œë“œ ë°”ë¡œ ë’¤ì— ì‘ì„±í•´ì•¼ í•¨
- SELECT DISTINCT í‚¤ì›Œë“œ ë‹¤ìŒì— ê³ ìœ í•œ ê°’ì„ ì„ íƒí•˜ë ¤ëŠ” í•˜ë‚˜ ì´ìƒì˜ í•„ë“œë¥¼ ì§€ì •
- ì˜ˆì‹œ
    - í…Œì´ë¸” customerì—ì„œ Country í•„ë“œì˜ ëª¨ë“  ë°ì´í„°ë¥¼ ì¤‘ë³µì—†ì´ ì˜¤ë¦„ì°¨ìˆœìœ¼ë¡œ ì¡°íšŒ
    
    ```sql
    SELECT DISTINCT
      Country
    FROM
      customers
    ORDER BY
      Country;
    ```
    

### WHERE

- ì¡°íšŒ ì‹œ íŠ¹ì • ê²€ìƒ‰ ì¡°ê±´ì„ ì§€ì •

```sql
SELECT
	select_list
FROM
	table_name
WHERE
	search_condition;
```

- FROM clause ë’¤ì— ìœ„ì¹˜
- search_conditionì€ ë¹„êµì—°ì‚°ì ë° ë…¼ë¦¬ì—°ì‚°ì(AND, OR, NOT ë“±)ë¥¼ ì‚¬ìš©í•˜ëŠ” êµ¬ë¬¸ì´ ì‚¬ìš©ë¨
- ì˜ˆì‹œ
    - í…Œì´ë¸” customersì—ì„œ City í•„ë“œ ê°’ì´ â€˜Pragueâ€™ì¸ ë°ì´í„°ì˜ LastName, FirstName, City ì¡°íšŒ
    
    ```sql
    SELECT
      LastName, FirstName, City
    FROM
      customers
    WHERE
      City = 'Prague';
    ```
    
    - í…Œì´ë¸” customersì—ì„œ City í•„ë“œ ê°’ì´ â€˜Pragueâ€™ê°€ ì•„ë‹Œ ë°ì´í„°ì˜ LastName, FirstName, City ì¡°íšŒ
    
    ```sql
    SELECT
      LastName, FirstName, City
    FROM
      customers
    WHERE
      City != 'Prague';
    ```
    
    - í…Œì´ë¸” customersì—ì„œ Company í•„ë“œ ê°’ì´ NULLì´ê³  Contry í•„ë“œ ê°’ì´ â€˜USAâ€™ì¸ ë°ì´í„°ì˜ LastName, FirstName, Company, Country ì¡°íšŒ
    
    ```sql
    SELECT
      LastName, FirstName, Company, Country
    FROM
      customers
    WHERE
      Company IS NULL AND Country = 'USA';
    ```
    
    - í…Œì´ë¸” customersì—ì„œ Company í•„ë“œ ê°’ì´ NULLì´ê±°ë‚˜ Country í•„ë“œ ê°’ì´ â€˜USAâ€™ì¸ ë°ì´í„°ì˜ LastName, FirstName, Company, Country ì¡°íšŒ
    
    ```sql
    SELECT
      LastName, FirstName, Company, Country
    FROM
      customers
    WHERE
      Company IS NULL OR Country = 'USA';
    ```
    
    - í…Œì´ë¸” tracksì—ì„œ Bytes í•„ë“œ ê°’ì´ 10000 ì´ìƒ 500000 ì´í•˜ì¸ ë°ì´í„°ì˜ Name, Bytes ì¡°íšŒ
    
    ```sql
    SELECT
      Name, Bytes
    FROM
      tracks
    WHERE
      Bytes BETWEEN 10000 and 500000;
    
    --WHERE
    --  10000 <= Bytes and Bytes <= 500000;
    ```
    
    - í…Œì´ë¸” tracksì—ì„œ Bytes í•„ë“œ ê°’ì´ 10000 ì´ìƒ 500000 ì´í•˜ì¸ ë°ì´í„°ì˜ Name, Bytesì„ Bytesë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì˜¤ë¦„ì°¨ìˆœ ì¡°íšŒ
    
    ```sql
     SELECT
      Name, Bytes
    FROM
      tracks
    WHERE
      Bytes BETWEEN 10000 and 500000
    ORDER BY
      Bytes;
    ```
    
    - í…Œì´ë¸” customersì—ì„œ Country í•„ë“œ ê°’ì´ â€˜Canadaâ€™ ë˜ëŠ” â€˜Germanyâ€™ ë˜ëŠ” â€˜Franceâ€™ì¸ ë°ì´í„°ì˜ LastName, FirstName, Country ì¡°íšŒ
    
    ```sql
    SELECT
      LastName, FirstName, Country
    FROM
      customers
    WHERE
      Country IN ('Canada', 'Germany', 'France');
    ```
    
    - í…Œì´ë¸” customersì—ì„œ Country í•„ë“œ ê°’ì´ â€˜Canadaâ€™ ë˜ëŠ” â€˜Germanyâ€™ ë˜ëŠ” â€˜Franceâ€™ê°€ ì•„ë‹Œ ë°ì´í„°ì˜ LastName, FirstName, Country ì¡°íšŒ
    
    ```sql
    SELECT
      LastName, FirstName, Country
    FROM
      customers
    WHERE
      Country NOT IN ('Canada', 'Germany', 'France');
    ```
    
    - í…Œì´ë¸” customersì—ì„œ LastName  í•„ë“œ ê°’ì´ sonìœ¼ë¡œ ëë‚˜ëŠ” ë°ì´í„°ì˜ LastName, FirstName ì¡°íšŒ
    
    ```sql
    SELECT
      LastName, FirstName
    FROM
      customers
    WHERE
      LastName LIKE '%son';
    ```
    
    - í…Œì´ë¸” customersì—ì„œ FirstName í•„ë“œ ê°’ì´ 4ìë¦¬ë©´ì„œ â€˜aâ€™ë¡œ ëë‚˜ëŠ” ë°ì´í„°ì˜ LastName, FirstName ì¡°íšŒ
    
    ```sql
    SELECT
      LastName, FirstName
    FROM
      customers
    WHERE
      FirstName LIKE '___a';
    ```
    

### Operators

#### Comparison Operators(ë¹„êµ ì—°ì‚°ì)

- =
- â‰¥
- â‰¤
- â‰ 
- IS
- LIKE
    - ê°’ì´ íŠ¹ì • íŒ¨í„´ì— ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸
    - Wildcardsì™€ í•¨ê»˜ ì‚¬ìš©
        - % : 0ê°œ ì´ìƒì˜ ë¬¸ìì—´ê³¼ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸
        - _ : ë‹¨ì¼ ë¬¸ìì™€ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸
- IN
    - ê°’ì´ íŠ¹ì • ëª©ë¡ ì•ˆì— ìˆëŠ”ì§€ í™•ì¸
- BETWEENâ€¦AND

#### Logical Operators(ë…¼ë¦¬ ì—°ì‚°ì)

- AND(&&)
- OR(||)
- NOT(!)

### LIMIT

- ì¡°íšŒí•˜ëŠ” ë ˆì½”ë“œ ìˆ˜ë¥¼ ì œí•œ

```sql
SELECT 
	select_list
FROM
	table_name
LIMIT [offset,] row_count;
```

- í•˜ë‚˜ ë˜ëŠ” ë‘ ê°œì˜ ì¸ìë¥¼ ì‚¬ìš©(0 ë˜ëŠ” ì–‘ì˜ ì •ìˆ˜)
- row_countëŠ” ì¡°íšŒí•˜ëŠ” ìµœëŒ€ ë ˆì½”ë“œ ìˆ˜ë¥¼ ì§€ì •
- ì˜ˆì‹œ
    - í…Œì´ë¸” tracksì—ì„œ TrackId, Name, Bytes í•„ë“œ ë°ì´í„°ë¥¼ Bytes ê¸°ì¤€ ë‚´ë¦¼ì°¨ìˆœìœ¼ë¡œ 7ê°œë§Œ ì¡°íšŒ
    
    ```sql
    SELECT
      TrackId, Name, Bytes
    FROM
      tracks
    ORDER BY
      Bytes DESC
    LIMIT 7;
    ```
    
    - í…Œì´ë¸” tracksì—ì„œ TrackId, Name, Bytes í•„ë“œ ë°ì´í„°ë¥¼ Bytes ê¸°ì¤€ ë‚´ë¦¼ì°¨ìˆœìœ¼ë¡œ 4ë²ˆì§¸ë¶€í„° 7ë²ˆì§¸ ë°ì´í„°ë§Œ ì¡°íšŒ
    
    ```sql
    SELECT
      TrackId, Name, Bytes
    FROM
      tracks
    ORDER BY
      Bytes DESC
    LIMIT 3, 4;
    ```
    

## Grouping data(DQL)

### GROUP BY

- ë ˆì½”ë“œë¥¼ ê·¸ë£¹í™”í•˜ì—¬ ìš”ì•½ë³¸ ìƒì„±
- `ì§‘ê³„ í•¨ìˆ˜`ì™€ í•¨ê»˜ ì‚¬ìš©
    - ê°’ì— ëŒ€í•œ ê³„ì‚°ì„ ìˆ˜í–‰í•˜ê³  ë‹¨ì¼í•œ ê°’ì„ ë°˜í™˜í•˜ëŠ” í•¨ìˆ˜
    - SUM, AVG, MAX, MIN, COUNT

```sql
SELECT
	c1, c2, ..., cn, aggregate_function(ci)
FROM
	table_name
GROUP BY
	c1, c2, ..., cn;

```

- FROM ë° WHERE ì ˆ ë’¤ì— ë°°ì¹˜
- GROUP BY ì ˆ ë’¤ì— ê·¸ë£¹í™” í•  í•„ë“œ ëª©ë¡ì„ ì‘ì„±
- ì˜ˆì‹œ
    - Country í•„ë“œë¥¼ ê·¸ë£¹í™”, ê° ê·¸ë£¹ì— ëŒ€í•œ ì§‘ê³„ ê°’ ê³„ì‚°
    
    ```sql
    SELECT
      Country, COUNT(*)
    FROM
      customers
    GROUP BY
      Country;
    ```
    
    - í…Œì´ë¸” tracksì—ì„œ Composer í•„ë“œë¥¼ ê·¸ë£¹í™”í•˜ì—¬ ê° ê·¸ë£¹ì— ëŒ€í•œ Bytes í‰ê·  ê°’ì„ ë‚´ë¦¼ì°¨ìˆœ ì¡°íšŒ
    
    ```sql
    SELECT
      Composer, AVG(Bytes)
    FROM
      tracks
    GROUP BY Composer
    ORDER BY AVG(Bytes) DESC;
    
    --SELECT
    --  Composer, AVG(Bytes) as avgOfBytes
    --FROM
    --  tracks
    --GROUP BY Composer
    --ORDER BY avgOfBytes DESC;
    ```
    
    - í…Œì´ë¸” tracksì—ì„œ Composer í•„ë“œë¥¼ ê·¸ë£¹í™”í•˜ì—¬ ê° ê·¸ë£¹ì— ëŒ€í•œ Millisecondesì˜ í‰ê·  ê°’ì´ 10 ë¯¸ë§Œì¸ ë°ì´í„° ì¡°íšŒ(ë‹¨, Milliseconds í•„ë“œëŠ” 60000ìœ¼ë¡œ ë‚˜ëˆ  ë¶„ ë‹¨ìœ„ ê°’ì˜ í‰ê· ìœ¼ë¡œ ê³„ì‚°)
    
    ```sql
    SELECT
      Composer, AVG(Milliseconds / 60000) as avgOfMinute
    FROM
      tracks
    GROUP BY
      Composer
    HAVING
      avgOfMinute < 10;
    
    # Having clause
    # ì§‘ê³„ í•­ëª©ì— ëŒ€í•œ ì„¸ë¶€ ì¡°ê±´ì„ ì§€ì •
    # ì£¼ë¡œ GROUP BYì™€ í•¨ê»˜ ì‚¬ìš©ë˜ë©° GROUP BYê°€ ì—†ë‹¤ë©´ WHERE ì²˜ëŸ¼ ë™ì‘
    ```
    

### SELECT statement ì‹¤í–‰ ìˆœì„œ

- í…Œì´ë¸”ì—ì„œ(FROM) â†’ íŠ¹ì • ì¡°ê±´ì— ë§ì¶”ì–´(WHERE) â†’ ê·¸ë£¹í™” í•˜ê³ (GROUP BY) â†’ ë§Œì•½ ê·¸ë£¹ ì¤‘ì—ì„œ ì¡°ê±´ì´ ìˆë‹¤ë©´ ë§ì¶”ê³ (HAVING) â†’ ì¡°íšŒí•˜ì—¬(SELECT) â†’ ì •ë ¬í•˜ê³ (ORDER BY) â†’ íŠ¹ì • ìœ„ì¹˜ì˜ ê°’ì„ ê°€ì ¸ì˜´(LIMIT)

## Create a table(DDL)

- í…Œì´ë¸” ìƒì„±

```sql
CREATE TABLE table_name (
	column_1 data_type constraints,
	column_2 data_type constratins,
	...,
);
```

- ê° í•„ë“œì— ì ìš©í•  ë°ì´í„° íƒ€ì… ì‘ì„±
- í…Œì´ë¸” ë° í•„ë“œì— ëŒ€í•œ ì œì•½ì¡°ê±´(contratins) ì‘ì„±
- ì˜ˆì‹œ
    - examples í…Œì´ë¸” ìƒì„± ë° í™•ì¸
    
    ```sql
    CREATE TABLE examples (
      ExamId INTEGER PRIMARY KEY AUTOINCREMENT,
      LastName VARCHAR(50) NOT NULL,
      FirstName VARCHAR(50) NOT NULL
    );
    ```
    
    ![Untitled 1](https://github.com/yuj1818/TIL/assets/95585314/cc02bc91-a961-4a87-83e0-04aa379138e5)
    
    - í…Œì´ë¸” ìŠ¤í‚¤ë§ˆ(êµ¬ì¡°) í™•ì¸
    
    ```sql
    PRAGMA table_info('examples');
    ```
    
    ![Untitled 2](https://github.com/yuj1818/TIL/assets/95585314/8f5cd902-9881-40a4-b19d-db4a2860d887)
    

### ë°ì´í„° íƒ€ì…

![Untitled 3](https://github.com/yuj1818/TIL/assets/95585314/ab5469d1-9856-4e9c-8566-15ee90dcbe0b)

- NULL
    - ì•„ë¬´ëŸ° ê°’ë„ í¬í•¨í•˜ì§€ ì•ŠìŒì„ ë‚˜íƒ€ëƒ„
- INTEGER
    - ì •ìˆ˜
- REAL
    - ë¶€ë™ ì†Œìˆ˜ì 
- TEXT
    - ë¬¸ìì—´
- BLOB
    - ì´ë¯¸ì§€, ë™ì˜ìƒ, ë¬¸ì„œ ë“±ì˜ ë°”ì´ë„ˆë¦¬ ë°ì´í„°

### ì œì•½ ì¡°ê±´(Constraints)

![Untitled 4](https://github.com/yuj1818/TIL/assets/95585314/cd936039-f7e5-4471-adc7-49f9fce91f1a)

- í…Œì´ë¸”ì˜ í•„ë“œì— ì ìš©ë˜ëŠ” ê·œì¹™ ë˜ëŠ” ì œí•œ ì‚¬í•­
- ë°ì´í„°ì˜ ë¬´ê²°ì„±ì„ ìœ ì§€í•˜ê³  ë°ì´í„°ë² ì´ìŠ¤ì˜ ì¼ê´€ì„±ì„ ë³´ì¥
- PRIMARY KEY
    - í•´ë‹¹ í•„ë“œë¥¼ ê¸°ë³¸ í‚¤ë¡œ ì§€ì •
    - **INTEGER íƒ€ì…ì—ë§Œ ì ìš©ë˜ë©° INT, BIGINT ë“±ê³¼ ê°™ì€ ì •ìˆ˜ ìœ í˜•ì€ ì ìš©ë˜ì§€ ì•ŠìŒ**
- NOT NULL
    - í•´ë‹¹ í•„ë“œì— NULL ê°’ì„ í—ˆìš©í•˜ì§€ ì•Šë„ë¡ ì§€ì •
- FOREIGN KEY
    - ë‹¤ë¥¸ í…Œì´ë¸”ê³¼ì˜ ì™¸ë˜ í‚¤ ê´€ê³„ë¥¼ ì •ì˜

### AUTOINCREMENT í‚¤ì›Œë“œ

![Untitled 5](https://github.com/yuj1818/TIL/assets/95585314/5798294d-8364-4cab-9fac-f48549b496a8)

- ìë™ìœ¼ë¡œ ê³ ìœ í•œ ì •ìˆ˜ ê°’ì„ ìƒì„±í•˜ê³  í• ë‹¹í•˜ëŠ” í•„ë“œ ì†ì„±
- í•„ë“œì˜ ìë™ ì¦ê°€ë¥¼ ë‚˜íƒ€ë‚´ëŠ” íŠ¹ìˆ˜í•œ í‚¤ì›Œë“œ
- ì£¼ë¡œ PRIMARY KEY í•„ë“œì— ì ìš©
- INTEGER PRIMARY KEY AUTOINCREMENTê°€ ì‘ì„±ëœ í•„ë“œëŠ” í•­ìƒ ìƒˆë¡œìš´ ë ˆì½”ë“œì— ëŒ€í•´ ì´ì „ ìµœëŒ€ ê°’ë³´ë‹¤ í° ê°’ì„ í• ë‹¹
- ì‚­ì œëœ ê°’ì„ ë¬´ì‹œë˜ë©° ì¬ì‚¬ìš©í•  ìˆ˜ ì—†ê²Œ ë¨

## Modifying table fields(DDL)

### ALTER

- í…Œì´ë¸” ë° í•„ë“œ ì¡°ì‘

| ëª…ë ¹ì–´ | ì—­í•  |
| --- | --- |
| ALTER TABLE ADD COLUMN | í•„ë“œ ì¶”ê°€ |
| ALTER TABLE RENAME COLUMN | í•„ë“œ ì´ë¦„ ë³€ê²½ |
| ALTER TABLE DROP COLUMN | í•„ë“œ ì‚­ì œ |
| ALTER TABLE RENAME TO | í…Œì´ë¸” ì´ë¦„ ë³€ê²½ |

#### ADD COLUMN

```sql
ALTER TABLE
	table_name
ADD COLUMN
	column_definition;
```

- ADD COLUMN í‚¤ì›Œë“œ ì´í›„ ì¶”ê°€í•˜ê³ ì í•˜ëŠ” ìƒˆ í•„ë“œ ì´ë¦„ê³¼ ë°ì´í„° íƒ€ì… ë° ì œì•½ ì¡°ê±´ ì‘ì„±
- ì˜ˆì‹œ
    - examples í…Œì´ë¸”ì— ë‹¤ìŒ ì¡°ê±´ì— ë§ëŠ” Country í•„ë“œ ì¶”ê°€
    
    ```sql
    ALTER TABLE 
      examples
    ADD COLUMN 
      Country VARCHAR(100) NOT NULL;
    ```
    
    - exampels í…Œì´ë¸”ì— ë‹¤ìŒ ì¡°ê±´ì— ë§ëŠ” Age, Address í•„ë“œ ì¶”ê°€
    
    ```sql
    ALTER TABLE examples
    ADD COLUMN Age INTEGER NOT NULL;
    
    ALTER TABLE examples
    ADD COLUMN Address VARCHAR(100) NOT NULL;
    ```
    

#### RENAME COLUMN

```sql
ALTER TABLE
 table_name
RENAME COLUMN
	current_name TO new_name
```

- RENAME COLUMN í‚¤ì›Œë“œ ë’¤ì— ì´ë¦„ì„ ë°”ê¾¸ë ¤ëŠ” í•„ë“œì˜ ì´ë¦„ì„ ì§€ì •í•˜ê³  TO í‚¤ì›Œë“œ ë’¤ì— ìƒˆ ì´ë¦„ì„ ì§€ì •
- ì˜ˆì‹œ
    - examples í…Œì´ë¸” Address í•„ë“œì˜ ì´ë¦„ì„ PostCodeë¡œ ë³€ê²½
    
    ```sql
    ALTER TABLE
    	examples
    RENAME COLUMN
    	Address TO PostCode;
    ```
    

#### DROP COLUMN

```sql
ALTER TABLE
	table_name
DROP COLUMN
	current_name
```

- DROP COLUMN í‚¤ì›Œë“œ ë’¤ì— ì‚­ì œí•˜ë ¤ëŠ” í•„ë“œì˜ ì´ë¦„ì„ ì§€ì •
- ì‚­ì œí•˜ëŠ” í•„ë“œê°€ ë‹¤ë¥¸ ë¶€ë¶„ì—ì„œ ì°¸ì¡°ë˜ì§€ ì•Šê³  PRIMARY KEYê°€ ì•„ë‹ˆë©° UNIQUE ì œì•½ ì¡°ê±´ì´ ì—†ëŠ” ê²½ìš°ì—ë§Œ ì‘ë™
- ì˜ˆì‹œ
    - examples í…Œì´ë¸”ì˜ PostCode í•„ë“œë¥¼ ì‚­ì œ
    
    ```sql
    ALTER TABLE
    	examples
    DROP COLUMN
    	PostCode;
    ```
    

#### RENAME TO

```sql
ALTER TABLE
	table_name
RENAME TO
	new_table_name;
```

- RENAME TO í‚¤ì›Œë“œ ë’¤ì— ìƒˆë¡œìš´ í…Œì´ë¸” ì´ë¦„ ì§€ì •
- ì˜ˆì‹œ
    - examples í…Œì´ë¸” ì´ë¦„ì„ new_examplesë¡œ ë³€ê²½
    
    ```sql
    ALTER TABLE
    	examples
    RENAME TO
    	new_examples;
    ```
    

## Delete a table(DDL)

### DROP TABLE

- í…Œì´ë¸” ì‚­ì œ

```sql
DROP TABLE table_name;
```

- DROP TABLE statement ì´í›„ ì‚­ì œí•  í…Œì´ë¸” ì´ë¦„ ì‘ì„±
- ì˜ˆì‹œ
    - examples í…Œì´ë¸” ì‚­ì œ
    
    ```sql
    DROP TABLE examples;
    ```
    

## Insert data(DML)

### INSERT

- í…Œì´ë¸” ë ˆì½”ë“œ ì‚½ì…

```sql
INSERT INTO table_name (c1, c2, ...)
VALUES (v1, v2, ...);
```

- INSERT INTO ì ˆ ë‹¤ìŒì— í…Œì´ë¸” ì´ë¦„ê³¼ ê´„í˜¸ ì•ˆì— í•„ë“œ ëª©ë¡ ì‘ì„±
- VALUES í‚¤ì›Œë“œ ë‹¤ìŒ ê´„í˜¸ ì•ˆì— í•´ë‹¹ í•„ë“œì— ì‚½ì…í•  ê°’ ëª©ë¡ ì‘ì„±
- ì˜ˆì‹œ
    - ì‹¤ìŠµ í…Œì´ë¸” ìƒì„±
    
    ```sql
    CREATE TABLE articles(
      id INTEGER PRIMARY KEY AUTOINCREMENT,
      title VARCHAR(100) NOT NULL,
      content VARCHAR(200) NOT NULL,
      createdAt DATE NOT NULL
    );
    ```
    
    - articles í…Œì´ë¸”ì— ë‹¤ìŒê³¼ ê°™ì€ ë°ì´í„° ì…ë ¥
    
    | title | content | createdAt |
    | --- | --- | --- |
    | hello | world | 2000-01-01 |
    
    ```sql
    INSERT INTO articles (title, content, createdAt)
    VALUES ('hello', 'world', '2000-01-01');
    ```
    
    - articles í…Œì´ë¸”ì— ë‹¤ìŒê³¼ ê°™ì€ ë°ì´í„° ì¶”ê°€ ì…ë ¥
    
    | title | content | createdAt |
    | --- | --- | --- |
    | title1 | content1 | 1900-01-01 |
    | title2 | content2 | 1800-01-01 |
    | title3 | content3 | 1700-01-01 |
    
    ```sql
    INSERT INTO articles (title, content, createdAt)
    VALUES
      ('title1', 'content1', '1900-01-01'),
      ('title2', 'content2', '1800-01-01'),
      ('title3', 'content3', '1700-01-01');
    ```
    
    - DATE í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•´ articles í…Œì´ë¸”ì— ë‹¤ìŒê³¼ ê°™ì€ ë°ì´í„° ì¶”ê°€ ì…ë ¥
    
    | title | content | createdAt |
    | --- | --- | --- |
    | mytitle | mycontent | 2023-10-10(ì˜¤ëŠ˜ë‚ ì§œ) |
    
    ```sql
    INSERT INTO articles (title, content, createdAt)
    VALUES ('mytitle', 'mycontent', DATE());
    ```
    

## Update data(DML)

### UPDATE

- í…Œì´ë¸” ë ˆì½”ë“œ ìˆ˜ì •

```sql
UPDATE table_name
SET column_name = expression,
[WHERE
	condition];
```

- SET ì ˆ ë‹¤ìŒì— ìˆ˜ì • í•  í•„ë“œì™€ ìƒˆ ê°’ì„ ì§€ì •
- WHERE ì ˆì—ì„œ ìˆ˜ì • í•  ë ˆì½”ë“œë¥¼ ì§€ì •í•˜ëŠ” ì¡°ê±´ ì‘ì„±
- WHERE ì ˆì„ ì‘ì„±í•˜ì§€ ì•Šìœ¼ë©´ ëª¨ë“  ë ˆì½”ë“œë¥¼ ìˆ˜ì •
- ì˜ˆì‹œ
    - articles í…Œì´ë¸” 1ë²ˆ ë ˆì½”ë“œì˜ title í•„ë“œ ê°’ì„ â€˜update Titleâ€™ë¡œ ë³€ê²½
    
    ```sql
    UPDATE articles
    SET title = 'update Title'
    WHERE id = 1;
    ```
    
    - articles í…Œì´ë¸” 2ë²ˆ ë ˆì½”ë“œì˜ title, content í•„ë“œ ê°’ì„ ê°ê° â€˜update Titleâ€™, â€˜update Contentâ€™ë¡œ ë³€ê²½
    
    ```sql
    UPDATE articles
    SET title = 'update Title', content = 'update Content'
    WHERE id = 2;
    ```
    

## Delete data(DML)

### DELETE

- í…Œì´ë¸” ë ˆì½”ë“œ ì‚­ì œ

```sql
DELETE FROM table_name
[WHERE
	condition];
```

- DELETE FROM ì ˆ ë‹¤ìŒì— í…Œì´ë¸” ì´ë¦„ ì‘ì„±
- WHERE ì ˆì—ì„œ ì‚­ì œí•  ë ˆì½”ë“œë¥¼ ì§€ì •í•˜ëŠ” ì¡°ê±´ ì‘ì„±
- WHERE ì ˆì„ ì‘ì„±í•˜ì§€ ì•Šìœ¼ë©´ ëª¨ë“  ë ˆì½”ë“œë¥¼ ì‚­ì œ
- ì˜ˆì‹œ
    - articles í…Œì´ë¸”ì˜ 1ë²ˆ ë ˆì½”ë“œ ì‚­ì œ
    
    ```sql
    DELETE FROM articles
    WHERE id = 1;
    ```
    
    - articles í…Œì´ë¸”ì—ì„œ ì‘ì„±ì¼ì´ ì˜¤ë˜ëœ ìˆœìœ¼ë¡œ ë ˆì½”ë“œ 2ê°œ ì‚­ì œ
    
    ```sql
    DELETE FROM articles
    WHERE id in (
      SELECT id FROM articles
      ORDER BY createdAt
      LIMIT 2
    );
    ```
    

## Join

### ê´€ê³„

- ì—¬ëŸ¬ í…Œì´ë¸” ê°„ì˜ (ë…¼ë¦¬ì ) ì—°ê²°

### ê´€ê³„ì˜ í•„ìš”ì„±

- ì»¤ë®¤ë‹ˆí‹° ê²Œì‹œíŒì— í•„ìš”í•œ ë°ì´í„° ìƒê°í•´ë³´ê¸°
    - id, title, content, writer, role
- íŠ¹ì • writerë¥¼ ê¸°ì¤€ìœ¼ë¡œ ê²Œì‹œê¸€ì„ ì¡°íšŒí•œë‹¤ë©´ ë™ëª…ì´ì¸ì´ ì¡´ì¬í•  ë•Œ, í˜¹ì€ íŠ¹ì • ë°ì´í„°ê°€ ìˆ˜ì •ë˜ì—ˆì„ ë•Œ ë¬¸ì œ ë°œìƒ
- ê·¸ëŸ¬ë¯€ë¡œ, í…Œì´ë¸”ì„ ë‚˜ëˆ„ì–´ì„œ ë¶„ë¥˜
    - ì˜ˆ) articles, users, roles
- articlesì™€ users í…Œì´ë¸”ì— ê°ê° userrId, roleId ì™¸ë˜ í‚¤ í•„ë“œ ì‘ì„±
    - ê´€ë¦¬ìì¸ ì‚¬ëŒë§Œ ë³´ê³  ì‹¶ë‹¤ë©´ roleId ê¸°ë°˜ìœ¼ë¡œ ì¡°íšŒ
    - ì‚¬ìš©ìê°€ ì´ë¦„ì„ ë°”ê¾¸ë©´ usersì—ì„œ í•œë²ˆë§Œ ë³€ê²½í•˜ë©´ ìë™ìœ¼ë¡œ ëª¨ë‘ ë³€ê²½

### JOINì´ í•„ìš”í•œ ìˆœê°„

- í…Œì´ë¸”ì„ ë¶„ë¦¬í•˜ë©´ ë°ì´í„° ê´€ë¦¬ëŠ” ìš©ì´í•´ì§ˆ ìˆ˜ ìˆìœ¼ë‚˜ ì¶œë ¥ì‹œì—ëŠ” ë¬¸ì œê°€ ìˆìŒ
- í…Œì´ë¸” í•œ ê°œ ë§Œì„ ì¶œë ¥í•  ìˆ˜ ë°–ì— ì—†ì–´ ë‹¤ë¥¸ í…Œì´ë¸”ê³¼ ê²°í•©í•˜ì—¬ ì¶œë ¥í•˜ëŠ” ê²ƒì´ í•„ìš”í•´ì§

## Joining tables

### JOIN

- ë‘˜ ì´ìƒì˜ í…Œì´ë¸”ì—ì„œ ë°ì´í„°ë¥¼ ê²€ìƒ‰í•˜ëŠ” ë°©ë²•

<aside>
ğŸ’¡ ì‹¤ìŠµ ë°ì´í„° ì¤€ë¹„

```sql
CREATE TABLE users (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  name VARCHAR(50) NOT NULL
);

CREATE TABLE articles (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  title VARCHAR(50) NOT NULL,
  content VARCHAR(100) NOT NULL,
  userId INTEGER NOT NULL,
  FOREIGN KEY (userId)
    REFERENCES users(id)
);

INSERT INTO
  users (name)
VALUES
  ('í•˜ì„ì£¼'), ('ì†¡ìœ¤ë¯¸'), ('ìœ í•˜ì„ ');

INSERT INTO
  articles (title, content, userId)
VALUES
  ('ì œëª©1', 'ë‚´ìš©1', 1),
  ('ì œëª©2', 'ë‚´ìš©2', 2),
  ('ì œëª©3', 'ë‚´ìš©3', 1),
  ('ì œëª©4', 'ë‚´ìš©4', 4),
  ('ì œëª©5', 'ë‚´ìš©5', 1);
```

</aside>

### JOINì˜ ì¢…ë¥˜

- INNER JOIN
    - ë‘ í…Œì´ë¸”ì—ì„œ ê°’ì´ ì¼ì¹˜í•˜ëŠ” ë ˆì½”ë“œì— ëŒ€í•´ì„œë§Œ ê²°ê³¼ë¥¼ ë°˜í™˜
    
    ```sql
    SELECT select_list FROM table_a
    INNER JOIN table_b ON table_b.fk = table_a.pk;
    ```
    
    - FROM ì ˆ ì´í›„ ë©”ì¸ í…Œì´ë¸” ì§€ì • (table_a)
    - INNER JOIN ì ˆ ì´í›„ ë©”ì¸ í…Œì´ë¸”ê³¼ ì¡°ì¸í•  í…Œì´ë¸”ì„ ì§€ì • (table_b)
    - ON í‚¤ì›Œë“œ ì´í›„ ì¡°ì¸ ì¡°ê±´ì„ ì‘ì„±
    - ì¡°ì¸ ì¡°ê±´ì€ table_aê³¼ table_b ê°„ì˜ ë ˆì½”ë“œë¥¼ ì¼ì¹˜ì‹œí‚¤ëŠ” ê·œì¹™ì„ ì§€ì •
    - ì˜ˆì‹œ
        - 1ë²ˆ íšŒì›(í•˜ì„ì£¼)ê°€ ì‘ì„±í•œ ëª¨ë“  ê²Œì‹œê¸€ì˜ ì œëª©ê³¼ ì‘ì„±ìëª…ì„ ì¡°íšŒ
        
        ```sql
        SELECT articles.title, users.name FROM articles
        INNER JOIN users
          ON users.id = articles.userId
        WHERE users.id = 1;
        ```
        
- LEFT JOIN
    - ì˜¤ë¥¸ìª½ í…Œì´ë¸”ì˜ ì¼ì¹˜í•˜ëŠ” ë ˆì½”ë“œì™€ í•¨ê»˜ ì™¼ìª½ í…Œì´ë¸”ì˜ ëª¨ë“  ë ˆì½”ë“œ ë°˜í™˜
    
    ```sql
    SELECT
    	select_list
    FROM
    	table_a
    LEFT JOIN table_b
    	ON table_b.fk = table_a.pk;
    ```
    
    - FROM ì ˆ ì´í›„ ì™¼ìª½ í…Œì´ë¸” ì§€ì • (table_a)
    - LEFT JOIN ì ˆ ì´í›„ ì˜¤ë¥¸ìª½ í…Œì´ë¸” ì§€ì • (table_b)
    - ON í‚¤ì›Œë“œ ì´í›„ ì¡°ì¸ ì¡°ê±´ì„ ì‘ì„±
        - ì™¼ìª½ í…Œì´ë¸”ì˜ ê° ë ˆì½”ë“œë¥¼ ì˜¤ë¥¸ìª½ í…Œì´ë¸”ì˜ ëª¨ë“  ë ˆì½”ë“œì™€ ì¼ì¹˜ì‹œí‚´
    - ì™¼ìª½ì€ í…Œì´ë¸”ì˜ ëª¨ë“  ë ˆì½”ë“œë¥¼ í‘œê¸°
    - ì˜¤ë¥¸ìª½ í…Œì´ë¸”ê³¼ ë§¤ì¹­ë˜ëŠ” ë ˆì½”ë“œê°€ ì—†ìœ¼ë©´ NULLì„ í‘œì‹œ
    - ì˜ˆì‹œ
        - ê²Œì‹œê¸€ì„ ì‘ì„±í•œ ì´ë ¥ì´ ì—†ëŠ” íšŒì› ì •ë³´ ì¡°íšŒ
        
        ```sql
        SELECT * FROM users
        LEFT JOIN articles
        	ON articles.userId = users.id
        WHERE articles.userId IS NULL;
        ```
        
## Many to one relationships - N : 1 or 1 : N

- í•œ í…Œì´ë¸”ì˜ 0ê°œ ì´ìƒì˜ ë ˆì½”ë“œê°€ ë‹¤ë¥¸ í…Œì´ë¸”ì˜ ë ˆì½”ë“œ í•œ ê°œì™€ ê´€ë ¨ëœ ê´€ê³„
- ì˜ˆì‹œ
    - comment(N) - article(1)
        - 0ê°œ ì´ìƒì˜ ëŒ“ê¸€ì€ 1ê°œì˜ ê²Œì‹œê¸€ì— ì‘ì„± ë  ìˆ˜ ìˆë‹¤.
        
        ![Untitled 7](https://github.com/yuj1818/TIL/assets/95585314/575b891a-8d94-485a-8f52-8a947be10887)
        

### ForeignKey(to, on_delete)

- N:1 ê´€ê³„ ì„¤ì • ëª¨ë¸ í•„ë“œ
- to
    - ì°¸ì¡°í•˜ëŠ” ëª¨ë¸ class ì´ë¦„
- on_delete
    - ì™¸ë˜ í‚¤ê°€ ì°¸ì¡°í•˜ëŠ” ê°ì²´(1)ê°€ ì‚¬ë¼ì¡Œì„ ë•Œ, ì™¸ë˜ í‚¤ë¥¼ ê°€ì§„ ê°ì²´(N)ë¥¼ ì–´ë–»ê²Œ ì²˜ë¦¬í•  ì§€ë¥¼ ì •ì˜í•˜ëŠ” ì„¤ì •(ë°ì´í„° ë¬´ê²°ì„±)
    - CASCADE
        - ë¶€ëª¨ ê°ì²´(ì°¸ì¡° ëœ ê°ì²´)ê°€ ì‚­ì œ ëì„ ë•Œ ì´ë¥¼ ì°¸ì¡°í•˜ëŠ” ê°ì²´ë„ ì‚­ì œ
        - ê¸°íƒ€ ì„¤ì • ê°’ ì°¸ê³ 
            - [https://docs.djangoproject.com/en/4.2/ref/models/fields/#arguments](https://docs.djangoproject.com/en/4.2/ref/models/fields/#arguments)

### ëŒ“ê¸€ ëª¨ë¸ êµ¬í˜„

#### ëŒ“ê¸€ ëª¨ë¸ ì •ì˜

- ForeignKey() í´ë˜ìŠ¤ì˜ ì¸ìŠ¤í„´ìŠ¤ ì´ë¦„ì€ ì°¸ì¡°í•˜ëŠ” ëª¨ë¸ í´ë˜ìŠ¤ ì´ë¦„ì˜ ë‹¨ìˆ˜í˜•ìœ¼ë¡œ ì‘ì„±í•˜ëŠ” ê²ƒì„ ê¶Œì¥
- ForeignKey í´ë˜ìŠ¤ë¥¼ ì‘ì„±í•˜ëŠ” ìœ„ì¹˜ì™€ ê´€ê³„ì—†ì´ ì™¸ë˜ í‚¤ëŠ” í…Œì´ë¸” í•„ë“œ ë§ˆì§€ë§‰ì— ìƒì„±ë¨

```python
# articles/models.py

class Comment(models.Model):
    article = models.ForeignKey(Article, on_delete=models.CASCADE)
    content = models.CharField(max_length=200)
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)
```

#### Migration

- ëŒ“ê¸€ í…Œì´ë¸”ì˜ article_id í•„ë“œ í™•ì¸
- ì°¸ì¡°í•˜ëŠ” í´ë˜ìŠ¤ ì´ë¦„ì˜ ì†Œë¬¸ì(ë‹¨ìˆ˜í˜•)ë¡œ ì‘ì„±í•˜ëŠ” ê²ƒì´ ê¶Œì¥ ë˜ì—ˆë˜ ì´ìœ 
    - â€˜ì°¸ì¡° ëŒ€ìƒ í´ë˜ìŠ¤ ì´ë¦„â€™ + â€˜_â€™ + â€˜í´ë˜ìŠ¤ ì´ë¦„â€™

### ëŒ“ê¸€ ìƒì„± ì—°ìŠµ

```bash
# ê²Œì‹œê¸€ ì‘ì„±
Articles.objects.create(title='title', content='content')

# Comment í´ë˜ìŠ¤ì˜ ì¸ìŠ¤í„´ìŠ¤ comment ìƒì„±
comment = Comment()

# ì¸ìŠ¤í„´ìŠ¤ ë³€ìˆ˜ ì €ì¥
comment.content = 'first content'

# DBì— ëŒ“ê¸€ ì €ì¥
comment.save()

# ì—ëŸ¬ ë°œìƒ
# articles_comment í…Œì´ë¸”ì˜ ForeignField, article_id ê°’ì´ ì €ì¥ ì‹œ ëˆ„ë½ë˜ì—ˆê¸° ë•Œë¬¸

# ê²Œì‹œê¸€ ì¡°íšŒ
article = Article.objects.get(pk=1)

# ì™¸ë˜ í‚¤ ë°ì´í„° ì…ë ¥
comment.article = article

# ëŒ“ê¸€ ì €ì¥ ë° í™•ì¸
comment.save()

# ë‘ë²ˆì§¸ ëŒ“ê¸€ ì‘ì„±
comment = Comment(content='second comment', article=article)
comment.save()

```

### ê´€ê³„ ëª¨ë¸ ì°¸ì¡°

#### ì—­ì°¸ì¡°

- N:1 ê´€ê³„ì—ì„œ 1ì—ì„œ Nì„ ì°¸ì¡°í•˜ê±°ë‚˜ ì¡°íšŒí•˜ëŠ” ê²ƒ(1 â†’ N)
- Nì€ ì™¸ë˜ í‚¤ë¥¼ ê°€ì§€ê³  ìˆì–´ ë¬¼ë¦¬ì ìœ¼ë¡œ ì°¸ì¡°ê°€ ê°€ëŠ¥í•˜ì§€ë§Œ 1ì€ Nì— ëŒ€í•œ ì°¸ì¡° ë°©ë²•ì´ ì¡´ì¬í•˜ì§€ ì•Šì•„ ë³„ë„ì˜ ì—­ì°¸ì¡° ì´ë¦„ì´ í•„ìš”
- article.comment_set.all()
    - article - ëª¨ë¸ ì¸ìŠ¤í„´ìŠ¤
    - comment_set - related manager(ì—­ì°¸ì¡° ì´ë¦„)
    - all() - QuerySet API

#### related manager

- N:1 í˜¹ì€ M:N ê´€ê³„ì—ì„œ ì—­ì°¸ì¡° ì‹œì— ì‚¬ìš©í•˜ëŠ” ë§¤ë‹ˆì €
- â€˜objectsâ€™ ë§¤ë‹ˆì €ë¥¼ í†µí•´ queryset apië¥¼ ì‚¬ìš©í–ˆë˜ ê²ƒì²˜ëŸ¼ related managerë¥¼ í†µí•´ queryset apië¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ ë¨
- ì´ë¦„ ê·œì¹™
    - N:1 ê´€ê³„ì—ì„œ ìƒì„±ë˜ëŠ” Related managerì˜ ì´ë¦„ì€ ì°¸ì¡°í•˜ëŠ” â€œëª¨ë¸ëª…_setâ€ ì´ë¦„ ê·œì¹™ìœ¼ë¡œ ë§Œë“¤ì–´ì§
    - í•´ë‹¹ ëŒ“ê¸€ì˜ ê²Œì‹œê¸€(Comment â†’ Article)
        - comment.article
    - ê²Œì‹œê¸€ì˜ ëŒ“ê¸€ ëª©ë¡(Article â†’ Comment)
        - article.comment_set.all()

```bash
# 1ë²ˆ ê²Œì‹œê¸€ ì¡°íšŒ
article = Article.objects.get(pk=1)

# 1ë²ˆ ê²Œì‹œê¸€ì— ì‘ì„±ëœ ëª¨ë“  ëŒ“ê¸€ ì¡°íšŒí•˜ê¸°
article.comment_set.all()

# 1ë²ˆ ê²Œì‹œê¸€ì— ì‘ì„±ëœ ëª¨ë“  ëŒ“ê¸€ ë‚´ìš© ì¶œë ¥
comments = article.comment_set.all()

for comment in comments:
	print(comment.content)
```

### ëŒ“ê¸€ êµ¬í˜„

#### ëŒ“ê¸€ CREATE

- ì‚¬ìš©ìë¡œë¶€í„° ëŒ“ê¸€ ë°ì´í„°ë¥¼ ì…ë ¥ ë°›ê¸° ìœ„í•œ CommentForm ì •ì˜
    
    ```python
    # articles/forms.py
    
    from django import forms
    from .models import Article, Comment
    
    class CommentForm(forms.ModelForm):
        class Meta:
            model = Comment
            fields = '__all__'
    ```
    
- detail view í•¨ìˆ˜ì—ì„œ CommentFormì„ ì‚¬ìš©í•˜ì—¬ detail í˜ì´ì§€ì— ë Œë”ë§
    
    ```python
    # articles/views.py
    
    form .forms import ArticleForm, CommentForm
    
    def detail(request, pk):
        article = Article.objects.get(pk=pk)
        comment_form = CommentForm()
        context = {
            'article': article,
            'comment_form': comment_form,
        }
        return render(request, 'articles/detail.html', context)
    ```
    
    ```html
    <form action="#" method="POST">
      {% csrf_token %}
      {{ comment_form }}
      <input type="submit">
    </form>
    ```
    
- Comment í´ë˜ìŠ¤ì˜ ì™¸ë˜ í‚¤ í•„ë“œ article ë˜í•œ ë°ì´í„° ì…ë ¥ì´ í•„ìš”í•œ í•„ë“œì´ê¸° ë•Œë¬¸ì— ìœ„ì™€ ê°™ì´ ì‘ì„±í•˜ë©´ article ì…ë ¥ formê¹Œì§€ ì¶œë ¥ ë¨
- í•˜ì§€ë§Œ, ì™¸ë˜ í‚¤ í•„ë“œëŠ” ì‚¬ìš©ì ì…ë ¥ ê°’ìœ¼ë¡œ ë°›ëŠ” ê²ƒì´ ì•„ë‹Œ view í•¨ìˆ˜ ë‚´ì—ì„œ ë‹¤ë¥¸ ë°©ë²•ìœ¼ë¡œ ì „ë‹¬ ë°›ì•„ ì €ì¥ë˜ì–´ì•¼ í•¨
- CommentFormì˜ ì¶œë ¥ í•„ë“œ ì¡°ì •
    
    ```python
    class CommentForm(forms.ModelForm):
        class Meta:
            model = Comment
            fields = ('content',)
    ```
    
    - ì¶œë ¥ì—ì„œ ì œì™¸ëœ ì™¸ë˜ í‚¤ ë°ì´í„°ëŠ” ì–´ë””ì„œ ë°›ì•„ì™€ì•¼ í•˜ëŠ”ê°€?
        - detail í˜ì´ì§€ì˜ url path(â€™<int:pk>/â€™, views.detail, name=â€™detailâ€™) ì—ì„œ í•´ë‹¹ ê²Œì‹œê¸€ì˜ pk ê°’ì´ ì‚¬ìš©ë˜ê³  ìˆìŒ
        - ëŒ“ê¸€ì˜ ì™¸ë˜ í‚¤ ë°ì´í„°ì— í•„ìš”í•œ ì •ë³´ê°€ ë°”ë¡œ ê²Œì‹œê¸€ì˜ pkê°’
- url ì‘ì„± ë° action ê°’ ì‘ì„±
    
    ```python
    # articles/urls.py
    urlpatterns = [
        ... ,
        path('<int:pk>/comments/', views.comments_create, name='comments_create'),
    ]
    ```
    
    ```html
    <!-- articles/detail.html -->
    <form action="{% url "articles:comments_create" article.pk %}" method="POST">
      {% csrf_token %}
      {{ comment_form }}
      <input type="submit">
    </form>
    ```
    
- comments_create view í•¨ìˆ˜ ì •ì˜
    
    ```python
    # articles/views.py
    
    def comments_create(request, pk):
        article = Article.objects.get(pk=pk)
        comment_form = CommentForm(request.POST)
        if comment_form.is_valid():
            comment_form.save()
            return redirect('articles:detail', article.pk)
        context = {
            'article': article,
            'comment_form': comment_form,
        }
        return render(request, 'articles/detail.html', context)
    ```
    
- saveì˜ commit ì¸ìë¥¼ í™œìš©í•´ ì™¸ë˜ í‚¤ ë°ì´í„° ì¶”ê°€ ì…ë ¥
    - `save(commit=False)`
        - DBì— ì €ì¥í•˜ì§€ ì•Šê³  ì¸ìŠ¤í„´ìŠ¤ë§Œ ë°˜í™˜
        - Create, but donâ€™t save the new instance
    
    ```python
    # articles/views.py
    
    def comments_create(request, pk):
        article = Article.objects.get(pk=pk)
        comment_form = CommentForm(request.POST)
        if comment_form.is_valid():
            comment = comment_form.save(commit=False)
    				comment.article = article
    				comment_form.save()
            return redirect('articles:detail', article.pk)
        context = {
            'article': article,
            'comment_form': comment_form,
        }
        return render(request, 'articles/detail.html', context)
    ```
    

#### ëŒ“ê¸€ READ

- detail view í•¨ìˆ˜ì—ì„œ ì „ì²´ ëŒ“ê¸€ ë°ì´í„°ë¥¼ ì¡°íšŒ
    
    ```python
    # articles/views.py
    
    from .models import Article, Comment
    
    def detail(request, pk):
        article = Article.objects.get(pk=pk)
        comment_form = CommentForm()
        comments = article.comment_set.all()
        context = {
            'article': article,
            'comment_form': comment_form,
            'comments': comments,
        }
        return render(request, 'articles/detail.html', context)
    ```
    
- ì „ì²´ ëŒ“ê¸€ ì¶œë ¥ ë° í™•ì¸
    
    ```html
    <!-- articles/detail.html -->
    
    <h4>ëŒ“ê¸€ ëª©ë¡</h4>
    <ul>
      {% for comment in comments %}
        <li>{{ comment.content }}</li>
      {% endfor %}
    </ul>
    ```
    

#### ëŒ“ê¸€ DELETE

- ëŒ“ê¸€ ì‚­ì œ url ì‘ì„±
    
    ```python
    # article/urls.py
    
    urlpatterns = [
        ... ,
        path('<int:article_pk>/comments/<int:comment_pk>/delete/',
             views.comments_delete,
             name='comments_delete'
        ),
    ]
    ```
    
- ëŒ“ê¸€ ì‚­ì œ view í•¨ìˆ˜ ì •ì˜
    
    ```python
    # articles/views.py
    
    def comments_delete(request, article_pk, comment_pk):
        comment = Comment.objects.get(pk=comment_pk)
        comment.delete()
        return redirect('articles:detail', article_pk)
    ```
    
- ëŒ“ê¸€ ì‚­ì œ ë²„íŠ¼ ì‘ì„±
    
    ```html
    <!-- articles/detail.html -->
    
    <h4>ëŒ“ê¸€ ëª©ë¡</h4>
    <ul>
      {% for comment in comments %}
        <li>
          {{ comment.content }}
          <form action="{% url "articles:comments_delete" article.pk comment.pk %}" method="POST">
            {% csrf_token %}
            <input type="submit" value="DELETE">
          </form>
        </li>
      {% endfor %}
    </ul>
    ```

### Article(N) - User(1)

- 0ê°œ ì´ìƒì˜ ê²Œì‹œê¸€ì€ 1ëª…ì˜ íšŒì›ì— ì˜í•´ ì‘ì„± ë  ìˆ˜ ìˆë‹¤.

#### Article-User ëª¨ë¸ ê´€ê³„ ì„¤ì •

```python
# articles/models.py

from django.conf import settings

class Article(models.Model):
    user = models.ForeignKey(settings.AUTH_USER_MODEL, on_delete=models.CASCADE)
    title = models.CharField(max_length=10)
    content = models.TextField()
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)
```

- User ëª¨ë¸ì„ ì°¸ì¡°í•˜ëŠ” 2ê°€ì§€ ë°©ë²•
    - django í”„ë¡œì íŠ¸ì˜ â€˜ë‚´ë¶€ì ì¸ êµ¬ë™ ìˆœì„œâ€™ì™€ â€˜ë°˜í™˜ ê°’â€™ì— ë”°ë¥¸ ì´ìœ 
    - **User ëª¨ë¸ì€ ì§ì ‘ ì°¸ì¡°í•˜ì§€ ì•ŠëŠ”ë‹¤**
    
    |  | get_user_model() | settings.AUTH_USER_MODEL |
    | --- | --- | --- |
    | ë°˜í™˜ ê°’ | User Object(ê°ì²´) | accounts.User(ë¬¸ìì—´) |
    | ì‚¬ìš© ìœ„ì¹˜ | models.pyê°€ ì•„ë‹Œ ë‹¤ë¥¸ ëª¨ë“  ìœ„ì¹˜ | models.py |

#### Migration

![Untitled 7](https://github.com/yuj1818/TIL/assets/95585314/b94edbe9-8d31-4f5c-9f77-ea411ec291b0)

- ê¸°ë³¸ì ìœ¼ë¡œ ëª¨ë“  ì»¬ëŸ¼ì€ NOT NULL ì œì•½ì¡°ê±´ì´ ìˆê¸° ë•Œë¬¸ì— ë°ì´í„° ì—†ì´ëŠ” ìƒˆë¡œìš´ í•„ë“œê°€ ì¶”ê°€ë˜ì§€ ëª»í•¨
    - ê¸°ë³¸ê°’ ì„¤ì • í•„ìš”
- 1ì„ ì…ë ¥í•˜ê³  Enter ì§„í–‰

![Untitled 8](https://github.com/yuj1818/TIL/assets/95585314/775c069b-acf4-4151-96a6-ba9f4597a7c2)

- ì¶”ê°€ë˜ëŠ” ì™¸ë˜ í‚¤ user_idì— ì–´ë–¤ ë°ì´í„°ë¥¼ ë„£ì„ ê²ƒì¸ì§€ ì§ì ‘ ì…ë ¥í•´ì•¼ í•¨
- ë§ˆì°¬ê°€ì§€ë¡œ 1 ì…ë ¥í•˜ê³  Enter ì§„í–‰
- ê·¸ëŸ¬ë©´ ê¸°ì¡´ì— ì‘ì„±ëœ ê²Œì‹œê¸€ì´ ìˆë‹¤ë©´ ëª¨ë‘ 1ë²ˆ íšŒì›ì´ ì‘ì„±í•œ ê²ƒìœ¼ë¡œ ì²˜ë¦¬ë¨

```bash
python manage.py migrate
```

- migrations íŒŒì¼ ìƒì„± í›„ migrate ì§„í–‰
- article í…Œì´ë¸”ì˜ user_id í•„ë“œ ìƒì„± í™•ì¸

#### ê²Œì‹œê¸€ CREATE

- ê¸°ì¡´ ArticleForm ì¶œë ¥ ë³€í™” í™•ì¸
- User ëª¨ë¸ì— ëŒ€í•œ ì™¸ë˜ í‚¤ ë°ì´í„° ì…ë ¥ì„ ìœ„í•´ ë¶ˆí•„ìš”í•œ inputì´ ì¶œë ¥
- ArticleForm ì¶œë ¥ í•„ë“œ ìˆ˜ì •

```python
# articles/forms.py

class ArticleForm(forms.ModelForm):
    class Meta:
        model = Article
        fields = ('title', 'content',)
```

- ê²Œì‹œê¸€ ì‘ì„± ì‹œ ì‘ì„±ì ì •ë³´ê°€ í•¨ê»˜ ì €ì¥ë  ìˆ˜ ìˆë„ë¡ saveì˜ commit ì˜µì…˜ í™œìš©

```python
# articles/views.py

def create(request):
    if request.method == 'POST':
        form = ArticleForm(request.POST)
        if form.is_valid():
            article = form.save(commit=False)
            article.user = request.user
            article.save()
            return redirect('articles:detail', article.pk)
    else:
			...
```

#### ê²Œì‹œê¸€ READ

- ê° ê²Œì‹œê¸€ì˜ ì‘ì„±ì ì´ë¦„ ì¶œë ¥

```html
<!-- articles/index.html -->

{% for article in articles %}
  <p>ì‘ì„±ì : {{ article.user }}</p>
  <p>ê¸€ ë²ˆí˜¸ : {{ article.pk }}</p>
  <a href="{% url "articles:detail" article.pk %}">
    <p>ê¸€ ì œëª© : {{ article.title }}</p>
  </a>
  <p>ê¸€ ë‚´ìš© : {{ article.content }}</p>
  <hr>
{% endfor %}
```

```html
<!-- articles/detail.html -->

<h2>DETAIL</h2>
<h3>{{ article.pk }} ë²ˆì§¸ ê¸€</h3>
<hr>
<p>ì‘ì„±ì : {{ article.user }}</p>
<p>ì œëª©: {{ article.title }}</p>
<p>ë‚´ìš©: {{ article.content }}</p>
<p>ì‘ì„± ì‹œê°: {{ article.created_at }}</p>
<p>ìˆ˜ì • ì‹œê°: {{ article.updated_at }}</p>
```

#### ê²Œì‹œê¸€ UPDATE

- ê²Œì‹œê¸€ ìˆ˜ì • ìš”ì²­ ì‚¬ìš©ìì™€ ê²Œì‹œê¸€ ì‘ì„± ì‚¬ìš©ìë¥¼ ë¹„êµí•˜ì—¬ ë³¸ì¸ì˜ ê²Œì‹œê¸€ë§Œ ìˆ˜ì •í•  ìˆ˜ ìˆë„ë¡ í•˜ê¸°

```python
# articles/views.py

def update(request, pk):
    article = Article.objects.get(pk=pk)
    if request.user == article.user:
        if request.method == 'POST':
            form = ArticleForm(request.POST, instance=article)
            if form.is_valid:
                form.save()
                return redirect('articles:detail', article.pk)
        else:
            form = ArticleForm(instance=article)
    else:
        return redirect('articles:index')
    context = {
        'article': article,
        'form': form,
    }
    return render(request, 'articles/update.html', context)
```

- í•´ë‹¹ ê²Œì‹œê¸€ì˜ ì‘ì„±ìê°€ ì•„ë‹ˆë¼ë©´, ìˆ˜ì •/ì‚­ì œ ë²„íŠ¼ì„ ì¶œë ¥í•˜ì§€ ì•Šë„ë¡ í•˜ê¸°

```html
<!-- articles/detail.html -->

{% if request.user == article.user %}
  <a href="{% url "articles:update" article.pk %}">UPDATE</a>
  <form action="{% url "articles:delete" article.pk %}" method="POST">
    {% csrf_token %}
    <input type="submit" value="ì‚­ì œ">
  </form>
{% endif %}
```

#### ê²Œì‹œê¸€ DELETE

- ì‚­ì œë¥¼ ìš”ì²­í•˜ë ¤ëŠ” ì‚¬ëŒê³¼ ê²Œì‹œê¸€ì„ ì‘ì„±í•œ ì‚¬ëŒì„ ë¹„êµí•˜ì—¬ ë³¸ì¸ì˜ ê²Œì‹œê¸€ë§Œ ì‚­ì œí•  ìˆ˜ ìˆë„ë¡ í•˜ê¸°

```python
# articles/views.py

def delete(request, pk):
    article = Article.objects.get(pk=pk)
    if request.user == article.user:
        article.delete()
    return redirect('articles:index')
```

### Comment(N) - User(1)

- 0ê°œ ì´ìƒì˜ ëŒ“ê¸€ì€ 1ëª…ì˜ íšŒì›ì— ì˜í•´ ì‘ì„± ë  ìˆ˜ ìˆë‹¤.

#### Comment-User ëª¨ë¸ ê´€ê³„ ì„¤ì •

- User ì™¸ë˜ í‚¤ ì •ì˜

```python
# articles/models.py

class Comment(models.Model):
    article = models.ForeignKey(Article, on_delete=models.CASCADE)
    user = models.ForeignKey(settings.AUTH_USER_MODEL, on_delete=models.CASCADE)
    content = models.CharField(max_length=200)
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)
```

#### Migration

- ì´ì „ì— Articleì™€ User ëª¨ë¸ ê´€ê³„ ì„¤ì • ë•Œì™€ ë™ì¼í•œ ìƒí™©
- ê¸°ì¡´ Comment í…Œì´ë¸”ì— ìƒˆë¡œìš´ ì»¬ëŸ¼ì´ ë¹ˆ ê°’ìœ¼ë¡œ ì¶”ê°€ë  ìˆ˜ ì—†ê¸° ë•Œë¬¸ì— ê¸°ë³¸ ê°’ ì„¤ì • ê³¼ì • í•„ìš”

#### ëŒ“ê¸€ CREATE

- ëŒ“ê¸€ ì‘ì„± ì‹œ ì‘ì„±ì ì •ë³´ê°€ í•¨ê»˜ ì €ì¥ë  ìˆ˜ ìˆë„ë¡ ì‘ì„±

```python
# articles/views.py

def comments_create(request, pk):
    article = Article.objects.get(pk=pk)
    comment_form = CommentForm(request.POST)
    if comment_form.is_valid():
        comment = comment_form.save(commit=False)
        comment.article = article
        comment.user = request.user
        comment_form.save()
        return redirect('articles:detail', article.pk)
    context = {
        'article': article,
        'comment_form': comment_form,
    }
    return render(request, 'articles/detail.html', context)
```

#### ëŒ“ê¸€ READ

- ëŒ“ê¸€ ì¶œë ¥ ì‹œ ëŒ“ê¸€ ì‘ì„±ìì™€ í•¨ê»˜ ì¶œë ¥

```html
<!-- articles/detail.html -->

{% for comment in comments %}
  <li>
    {{ comment.user}} - {{ comment.content }}
    <form action="{% url "articles:comments_delete" article.pk comment.pk %}" method="POST">
      {% csrf_token %}
      <input type="submit" value="ì‚­ì œ">
    </form>
  </li>
{% endfor %}
```

#### ëŒ“ê¸€ DELETE

- ëŒ“ê¸€ ì‚­ì œ ìš”ì²­ ì‚¬ìš©ìì™€ ëŒ“ê¸€ ì‘ì„± ì‚¬ìš©ìë¥¼ ë¹„êµí•˜ì—¬ ë³¸ì¸ì˜ ëŒ“ê¸€ë§Œ ì‚­ì œí•  ìˆ˜ ìˆë„ë¡ í•˜ê¸°

```python
# articles/views.py

def comments_delete(request, article_pk, comment_pk):
    comment = Comment.objects.get(pk=comment_pk)
    if request.user == comment.user:
        comment.delete()
    return redirect('articles:detail', article_pk)
```

- í•´ë‹¹ ëŒ“ê¸€ì˜ ì‘ì„±ìê°€ ì•„ë‹ˆë¼ë©´, ëŒ“ê¸€ ì‚­ì œ ë²„íŠ¼ì„ ì¶œë ¥í•˜ì§€ ì•Šë„ë¡ í•¨

```html
<!-- articles/detail.html -->

{% if request.user == comment.user %}
  <form action="{% url "articles:comments_delete" article.pk comment.pk %}" method="POST">
    {% csrf_token %}
    <input type="submit" value="ì‚­ì œ">
  </form>
{% endif %}
```

## Many to many relationships(N : M or M : N)

- í•œ í…Œì´ë¸”ì˜ 0ê°œ ì´ìƒì˜ ë ˆì½”ë“œê°€ ë‹¤ë¥¸ í…Œì´ë¸”ì˜ 0ê°œ ì´ìƒì˜ ë ˆì½”ë“œì™€ ê´€ë ¨ëœ ê²½ìš°
- ì–‘ìª½ ëª¨ë‘ì—ì„œ N:1 ê´€ê³„ë¥¼ ê°€ì§

### N : 1ì˜ í•œê³„

- í•œ ëª…ì˜ ì˜ì‚¬ì—ê²Œ ì—¬ëŸ¬ í™˜ìê°€ ì˜ˆì•½í•œë‹¤ê³  ê°€ì •
- 2ëª…ì˜ ì˜ì‚¬ì™€ 2ëª…ì˜ í™˜ìê°€ ì¡´ì¬

![Untitled 9](https://github.com/yuj1818/TIL/assets/95585314/9a7d4cc1-e364-445f-a9d6-9b4be917d03c)

- 1ë²ˆ í™˜ìê°€ ë‘ ì˜ì‚¬ ëª¨ë‘ì—ê²Œ ì§„ë£Œë¥¼ ë°›ê³ ì í•œë‹¤ë©´ í™˜ì í…Œì´ë¸”ì— 1ë²ˆ í™˜ì ë°ì´í„°ê°€ ì¤‘ë³µìœ¼ë¡œ ì…ë ¥ë  ìˆ˜ ìˆìŒ

![Untitled 10](https://github.com/yuj1818/TIL/assets/95585314/fa850374-c70a-4ac7-953f-e63799835624)

- ë™ì¼í•œ í™˜ìì§€ë§Œ ë‹¤ë¥¸ ì˜ì‚¬ì—ê²Œë„ ì§„ë£Œ ë°›ê¸° ìœ„í•´ ì˜ˆì•½í•˜ê¸° ìœ„í•´ì„œëŠ” ê°ì²´ë¥¼ í•˜ë‚˜ ë” ë§Œë“¤ì–´ ì§„í–‰í•´ì•¼ í•¨
- ì™¸ë˜ í‚¤ ì»¬ëŸ¼ì— â€˜1, 2â€™ í˜•íƒœë¡œ ì €ì¥ ë° ì°¸ì¡°í•˜ëŠ” ê²ƒì„ DB íƒ€ì… ë¬¸ì œë¡œ ë¶ˆê°€ëŠ¥
- **ì˜ˆì•½ í…Œì´ë¸”ì„ ë”°ë¡œ ë§Œë“¤ì–´ì„œ í•´ê²°**

### ì¤‘ê°œ ëª¨ë¸

- ì˜ˆì•½ ëª¨ë¸ ìƒì„±

```python
# hospitals/models.py

class Doctor(models.Model):
    name = models.TextField()

    def __str__(self):
        return f'{self.pk}ë²ˆ ì˜ì‚¬ {self.name}'
    
class Patient(models.Model):
    doctor = models.ForeignKey(Doctor, on_delete=models.CASCADE)
    name = models.TextField()

    def __str__(self):
        return f'{self.pk}ë²ˆ í™˜ì {self.name}'
    
class Reservation(models.Model):
    doctor = models.ForeignKey(Doctor, on_delete=models.CASCADE)
    patient = models.ForeignKey(Patient, on_delete=models.CASCADE)

    def __str__(self):
        return f'{self.doctor_id}ë²ˆ ì˜ì‚¬ì˜ {self.patient_id}ë²ˆ í™˜ì'
```

- Djangoì—ì„œëŠ” ManyToManyFieldë¡œ ì¤‘ê°œ ëª¨ë¸ì„ ìë™ìœ¼ë¡œ ìƒì„±

### ManyToManyField

```python
# hospitals/models

class Doctor(models.Model):
    name = models.TextField()

    def __str__(self):
        return f'{self.pk}ë²ˆ ì˜ì‚¬ {self.name}'
    
class Patient(models.Model):
    doctors = models.ManyToManyField(Doctor)
    name = models.TextField()

    def __str__(self):
        return f'{self.pk}ë²ˆ í™˜ì {self.name}'
```

- Migration ì§„í–‰ í›„, ìƒì„±ëœ ì¤‘ê°œ í…Œì´ë¸” í™•ì¸

![Untitled 11](https://github.com/yuj1818/TIL/assets/95585314/fb7bdeb0-d69e-4700-929c-92a4146ae4c6)

- ì˜ˆì•½ ìƒì„±
    - í™˜ì
    
    ```python
    patient1.doctors.add(doctor1)
    ```
    
    - ì˜ì‚¬
    
    ```python
    doctors1.patient_set.add(patient2)
    ```
    
- ì˜ˆì•½ ì·¨ì†Œ
    - í™˜ì
    
    ```python
    patient2.doctors.remove(doctor1)
    ```
    
    - ì˜ì‚¬
    
    ```python
    doctor1.patient_set.remove(patient1)
    ```
    

### â€˜throughâ€™ argument

<aside>
ğŸ’¡ ë§Œì•½ ì˜ˆì•½ ì •ë³´ì— ì¦ìƒ, ì˜ˆì•½ì¼ ë“± ì¶”ê°€ ì •ë³´ê°€ í¬í•¨ë˜ì–´ì•¼ í•œë‹¤ë©´?

</aside>

- ì¤‘ê°œ í…Œì´ë¸”ì— â€˜ì¶”ê°€ ë°ì´í„°â€™ë¥¼ ì‚¬ìš©í•´ M:N ê´€ê³„ë¥¼ í˜•ì„±í•˜ë ¤ëŠ” ê²½ìš°ì— ì‚¬ìš©
- ì˜ˆì‹œ
    - through ì„¤ì • ë° Reservation Class ìˆ˜ì •
    - ì˜ˆì•½ ì •ë³´ì— ì¦ìƒ, ì˜ˆì•½ì¼ ì´ë¼ëŠ” ì¶”ê°€ ë°ì´í„° ìƒì„±
    
    ```python
    # hospitals/models.py
        
    class Patient(models.Model):
        doctors = models.ManyToManyField(Doctor, through='Reservation')
        name = models.TextField()
    
        def __str__(self):
            return f'{self.pk}ë²ˆ í™˜ì {self.name}'
        
    class Reservation(models.Model):
        doctor = models.ForeignKey(Doctor, on_delete=models.CASCADE)
        patient = models.ForeignKey(Patient, on_delete=models.CASCADE)
        symptom = models.TextField()
        reserved_at = models.DateTimeField(auto_now_add=True)
    
        def __str__(self):
            return f'{self.doctor_id}ë²ˆ ì˜ì‚¬ì˜ {self.patient_id}ë²ˆ í™˜ì'
    ```
    
    - ì˜ˆì•½ ìƒì„± - ë°©ë²• 1
        - Reservation classë¥¼ í†µí•œ ì˜ˆì•½ ìƒì„±
        
        ```python
        reservation1 = Reservation(doctor=doctor1, patient=patient1, symptom='headache')
        reservation1.save()
        ```
        
    - ì˜ˆì•½ ìƒì„± - ë°©ë²•2
        - Patient ê°ì²´ë¥¼ í†µí•œ ì˜ˆì•½ ìƒì„±(through_defaults)
        
        ```python
        patient2.doctors.add(doctor1, through_defaults={'symptom': 'flu'})
        ```
        
    - ì˜ˆì•½ ì‚­ì œ
        - ì˜ì‚¬
        
        ```python
        doctor1.patient_set.remove(patient1)
        ```
        
        - í™˜ì
        
        ```python
        patient2.doctors.remove(doctor1)
        ```
        

### M : N ê´€ê³„ ì£¼ìš” ì‚¬í•­

- M:N ê´€ê³„ë¡œ ë§ºì–´ì§„ ë‘ í…Œì´ë¸”ì—ëŠ” ë¬¼ë¦¬ì ì¸ ë³€í™”ê°€ ì—†ìŒ
- ManyToManyFieldëŠ” ì¤‘ê°œ í…Œì´ë¸”ì„ ìë™ìœ¼ë¡œ ìƒì„±
- ManyToManyFieldëŠ” M:N ê´€ê³„ë¥¼ ë§ºëŠ” ë‘ ëª¨ë¸ ì–´ë””ì— ìœ„ì¹˜í•´ë„ ìƒê´€ ì—†ìŒ
    - ëŒ€ì‹  í•„ë“œ ì‘ì„± ìœ„ì¹˜ì— ë”°ë¼ ì°¸ì¡°ì™€ ì—­ì°¸ì¡° ë°©í–¥ì„ ì£¼ì˜í•  ê²ƒ
- N:1ì€ ì™„ì „í•œ ì¢…ì†ì˜ ê´€ê³„ì˜€ì§€ë§Œ M:Nì€ ì¢…ì†ì ì¸ ê´€ê³„ê°€ ì•„ë‹ˆë©° â€˜ì˜ì‚¬ì—ê²Œ ì§„ì°° ë°›ëŠ” í™˜ì & í™˜ìë¥¼ ì§„ì°°í•˜ëŠ” ì˜ì‚¬â€™ ì´ë ‡ê²Œ 2ê°€ì§€ í˜•íƒœ ëª¨ë‘ í‘œí˜„ ê°€ëŠ¥

### Django ManyToManyField

`ManyToManyField(to, **options)`

- Many to many ê´€ê³„ ì„¤ì • ì‹œ ì‚¬ìš©í•˜ëŠ” ëª¨ë¸ í•„ë“œ

â€˜related_nameâ€™ arguments

- ì—­ì°¸ì¡° ì‹œ ì‚¬ìš©í•˜ëŠ” manager nameì„ ë³€ê²½

```python
class Patient(models.Model):
    doctors = models.ManyToManyField(Doctor, related_name='patients')
    name = models.TextField()
```

```python
# ë³€ê²½ ì „
doctor.patient_set.all()

# ë³€ê²½ í›„
doctor.patients.all()
```

#### â€˜symmetricalâ€™ arguments

- ManyToManyFieldê°€ ë™ì¼í•œ ëª¨ë¸ì„ ê°€ë¦¬í‚¤ëŠ” ì •ì˜ì—ì„œë§Œ ì‚¬ìš©
    - Trueì¼ ê²½ìš°
        - source ëª¨ë¸ì˜ ì¸ìŠ¤í„´ìŠ¤ê°€ target ëª¨ë¸ì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì°¸ì¡°í•˜ë©´ ìë™ìœ¼ë¡œ target ëª¨ë¸ ì¸ìŠ¤í„´ìŠ¤ë„ source ëª¨ë¸ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìë™ìœ¼ë¡œ ì°¸ì¡°í•˜ë„ë¡ í•¨(ëŒ€ì¹­)
        - ì¦‰, ìë™ìœ¼ë¡œ ë‚´ê°€ ë‹¹ì‹ ì˜ ì¹œêµ¬ë¼ë©´ ë‹¹ì‹ ë„ ë‚´ ì¹œêµ¬ê°€ ë¨
    - Falseì¼ ê²½ìš°
        - Trueì˜€ì„ ë•Œì™€ ë°˜ëŒ€(ëŒ€ì¹­X)
    
    ```python
    class Person(models.Model):
    friends = models.ManyToManyField('self')
    # friends = models.ManyToManyField('self', symmetrical=False)
    ```
    

### M : Nì—ì„œì˜ methods

#### add()

- ì§€ì •ëœ ê°ì²´ë¥¼ ê´€ë ¨ ê°ì²´ ì§‘í•©ì— ì¶”ê°€
- ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ê´€ê³„ì— ì‚¬ìš©í•˜ë©´ ê´€ê³„ê°€ ë³µì œë˜ì§€ ì•ŠìŒ

#### remove()

- ê´€ë ¨ ê°ì²´ ì§‘í•©ì—ì„œ ì§€ì •ëœ ëª¨ë¸ ê°ì²´ë¥¼ ì œê±°

### Article(M) - User(N)

- 0ê°œ ì´ìƒì˜ ê²Œì‹œê¸€ì€ 0ëª… ì´ìƒì˜ íšŒì›ê³¼ ê´€ë ¨
- ê²Œì‹œê¸€ì€ íšŒì›ìœ¼ë¡œë¶€í„° 0ê°œ ì´ìƒì˜ ì¢‹ì•„ìš”ë¥¼ ë°›ì„ ìˆ˜ ìˆê³ , íšŒì›ì€ 0ê°œ ì´ìƒì˜ ê²Œì‹œê¸€ì— ì¢‹ì•„ìš”ë¥¼ ëˆ„ë¥¼ ìˆ˜ ìˆìŒ

#### ëª¨ë¸ ê´€ê³„ ì„¤ì •

```python
# articles/models.py

class Article(models.Model):
    user = models.ForeignKey(
        settings.AUTH_USER_MODEL, on_delete=models.CASCADE
    )
    like_users = models.ManyToManyField(settings.AUTH_USER_MODEL, related_name='like_articles')
    title = models.CharField(max_length=10)
    content = models.TextField()
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)
```

- user.article_set ì—­ì°¸ì¡° ë§¤ë‹ˆì € ì¶©ëŒ
    - N:1 - ìœ ì €ê°€ ì‘ì„±í•œ ê²Œì‹œê¸€
    - M:N - ìœ ì €ê°€ ì¢‹ì•„ìš” í•œ ê²Œì‹œê¸€
    - ì´ì „ N:1(Article-User) ê´€ê³„ì—ì„œ ì´ë¯¸ ê°™ì€ ì´ë¦„ì˜ ë§¤ë‹ˆì €ë¥¼ ì‚¬ìš© ì¤‘
    - userì™€ ê´€ê³„ëœ ForeignKey í˜¹ì€ ManyToManyField ë‘˜ ì¤‘ í•˜ë‚˜ì— related_name ì‘ì„± í•„ìš”

<aside>
ğŸ’¡ User-Article ê°„ ì‚¬ìš© ê°€ëŠ¥í•œ ì „ì²´ related manager

- article.user
    - ê²Œì‹œê¸€ì„ ì‘ì„±í•œ ìœ ì € - N:1
- user.article_set
    - ìœ ì €ê°€ ì‘ì„±í•œ ê²Œì‹œê¸€(ì—­ì°¸ì¡°) - N:1
- articles.like_users
    - ê²Œì‹œê¸€ì„ ì¢‹ì•„ìš” í•œ ìœ ì € - M:N
- user.like_articles
    - ìœ ì €ê°€ ì¢‹ì•„ìš” í•œ ê²Œì‹œê¸€(ì—­ì°¸ì¡°) - M:N
</aside>

### ì¢‹ì•„ìš”  ê¸°ëŠ¥ êµ¬í˜„

```python
# articles/urls.py

from django.urls import path
from . import views

app_name = 'articles'
urlpatterns = [
    ...
    path('<int:article_pk>/likes/', views.likes, name='likes'),
]
```

```python
# articles/views.py

@login_required
def likes(request, article_pk):
    article = Article.objects.get(pk=article_pk)
    if request.user in article.like_users.all():
        article.like_users.remove(request.user)
    else:
        article.like_users.add(request.user)
    return redirect('articles:index')
```

```html
<!-- articles/index.html -->

{% for article in articles %}
    <p>ì‘ì„±ì : {{ article.user }}</p>
    <p>ê¸€ ë²ˆí˜¸ : {{ article.pk }}</p>
    <a href="{% url "articles:detail" article.pk %}">
      <p>ê¸€ ì œëª© : {{ article.title }}</p>
    </a>
    <p>ê¸€ ë‚´ìš© : {{ article.content }}</p>
    <form action="{% url "articles:like" article.pk %}" method="POST">
      {% csrf_token %}
      {% if request.user in article.like_users.all %}
        <input type="submit" value="ì¢‹ì•„ìš” ì·¨ì†Œ">
      {% else %}
        <input type="submit" value="ì¢‹ì•„ìš”">
      {% endif %}
    </form>
    <hr>
  {% endfor %}
```

### í”„ë¡œí•„ í˜ì´ì§€ êµ¬í˜„

- ê° íšŒì›ì˜ ê°œì¸ í”„ë¡œí•„ í˜ì´ì§€ì— íŒ”ë¡œìš° ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ê¸° ìœ„í•´ í”„ë¡œí•„ í˜ì´ì§€ë¥¼ ë¨¼ì € êµ¬í˜„

```python
# accounts/urls.py

urlpatterns = [
    ...
    path('profile/<username>/', views.profile, name='profile'),
]
```

```python
# accounts/views.py

import django.contrib.auth import get_user_model

def profile(request, username):
    User = get_user_model()
    person = User.objects.get(username=username)
    context = {
        'person': person,
    }
    return render(request, 'accounts/profile.html', context)
```

```html
<!-- accounts/profile.html -->

<h1>{{ person.username }}ë‹˜ì˜ í”„ë¡œí•„</h1>
  <hr>
  <h2>{{ person.username }}ê°€ ì‘ì„±í•œ ê²Œì‹œê¸€</h2>
  {% for article in person.article_set.all %}
      <div>{{ article.title }}</div>
  {% endfor %}
  <hr>
  <h2>{{ person.username }}ê°€ ì‘ì„±í•œ ëŒ“ê¸€</h2>
  {% for comment in person.comment_set.all %}
      <div>{{ comment.content }}</div>
  {% endfor %}
  <hr>
  <h2>{{ person.username }}ê°€ ì¢‹ì•„ìš”í•œ ê²Œì‹œê¸€</h2>
  {% for article in person.like_articles.all %}
      <div>{{ article.title }}</div>
  {% endfor %}
```

```html
<!-- articles/index.html -->

<a href="{% url "accounts:profile" user.username %}">ë‚´ í”„ë¡œí•„</a>

<p>ì‘ì„±ì : <a href="{% url "accounts:profile" article.user.username %}">{{ article.user }}</a></p>
```

### User(M) - User(N)

- 0ëª… ì´ìƒì˜ íšŒì›ì€ 0ëª… ì´ìƒì˜ íšŒì›ê³¼ ê´€ë ¨
- íšŒì›ì€ 0ëª… ì´ìƒì˜ íŒ”ë¡œì›Œë¥¼ ê°€ì§ˆ ìˆ˜ ìˆê³ , 0ëª… ì´ìƒì˜ ë‹¤ë¥¸ íšŒì›ë“¤ì„ íŒ”ë¡œì‰ í•  ìˆ˜ ìˆìŒ

### íŒ”ë¡œìš° ê¸°ëŠ¥ êµ¬í˜„

#### ManyToManyField ì‘ì„±

```python
# accounts/models.py

class User(AbstractUser):
    following = models.ManyToManyField('self', symmetrical=False, related_name='followers')
```

- ì°¸ì¡°
    - ë‚´ê°€ íŒ”ë¡œìš°í•˜ëŠ” ì‚¬ëŒë“¤(íŒ”ë¡œì‰, followings)
- ì—­ì°¸ì¡°
    - ìƒëŒ€ë°© ì…ì¥ì—ì„œ ë‚˜ëŠ” íŒ”ë¡œì›Œ ì¤‘ í•œ ëª…(íŒ”ë¡œì›Œ, followers)
- ë°”ë€Œì–´ë„ ìƒê´€ ì—†ìœ¼ë‚˜ ê´€ê³„ ì¡°íšŒ ì‹œ ìƒê°í•˜ê¸° í¸í•œ ë°©í–¥ìœ¼ë¡œ ì •í•œ ê²ƒ

#### url ì‘ì„±

```python
# accounts/urls.py

urlpatterns = [
    ...
    path('<int:user_pk>/follow/', views.follow, name='follow'),
]
```

#### view í•¨ìˆ˜ ì‘ì„±

```python
# accounts/views.py

def follow(request, user_pk):
    User = get_user_model()
    person = User.objects.get(pk=user_pk)
    if person != request.user:
        if request.user in person.followers.all():
            person.followers.remove(request.user)
        else:
            person.followers.add(request.user)
    return redirect('accounts:profile', person.username)
```

#### í”„ë¡œí•„ ìœ ì €ì˜ íŒ”ë¡œì‰, íŒ”ë¡œì›Œ ìˆ˜ & íŒ”ë¡œìš°, ì–¸íŒ”ë¡œìš° ë²„íŠ¼ ì‘ì„±

```html
<!-- accounts/profile.html -->

<h1>{{ person.username }}ë‹˜ì˜ í”„ë¡œí•„</h1>
    <div>
        <div>
            íŒ”ë¡œì‰ : {{ person.followings.all|length }} / íŒ”ë¡œì›Œ : {{ person.followers.all|length}}
        </div>
        {% if request.user != person %}
            <div>
                <form action="{% url "accounts:follow" person.pk %}" method="POST">
                    {% csrf_token %}
                    {% if request.user in person.followers %}
                        <input type="submit" value="Unfollow">
                    {% else %}
                        <input type="submit" value="Follow">
                    {% endif %}
                </form>
            </div>
        {% endif %}
    </div>
    <hr>
```

## Fixtures

- Djangoê°€ ë°ì´í„°ë² ì´ìŠ¤ë¡œ ê°€ì ¸ì˜¤ëŠ” ë°©ë²•ì„ ì•Œê³  ìˆëŠ” ë°ì´í„° ëª¨ìŒ
- ë°ì´í„°ë² ì´ìŠ¤ êµ¬ì¡°ì— ë§ì¶”ì–´ ì‘ì„± ë˜ì–´ìˆìŒ

### Fixturesì˜ ì‚¬ìš© ëª©ì 

- ì´ˆê¸° ë°ì´í„° ì œê³µ
- ì´ˆê¸° ë°ì´í„°ì˜ í•„ìš”ì„±
    - í˜‘ì—… í•˜ëŠ” ê²½ìš° ê°€ì •. ìœ ì € A, B ì¡´ì¬
        - Aê°€ ë¨¼ì € ì‘ì—… í›„ githubì— push
        - .gitignoreë¡œ ì¸í•´ DBëŠ” ì—…ë¡œë“œí•˜ì§€ ì•Šê¸° ë•Œë¬¸ì— Aê°€ ìƒì„±í•œ ë°ì´í„°ë„ ì—…ë¡œë“œë˜ì§€ ì•ŠìŒ
        - Bê°€ githubì—ì„œ Aê°€ pushí•œ í”„ë¡œì íŠ¸ pull
        - ê²°ê³¼ì ìœ¼ë¡œ BëŠ” DBê°€ ì—†ëŠ” í”„ë¡œì íŠ¸ë¥¼ ë°›ê²Œ ë¨
    - Django í”„ë¡œì íŠ¸ì˜ ì•±ì„ ì²˜ìŒ ì„¤ì •í•  ë•Œ ë™ì¼í•˜ê²Œ ì¤€ë¹„ ëœ ë°ì´í„°ë¡œ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ë¯¸ë¦¬ ì±„ìš°ëŠ” ê²ƒì´ í•„ìš”í•œ ìˆœê°„ì´ ìˆìŒ

### Fixture ê´€ë ¨ ëª…ë ¹ì–´

`dumpdata`

- ë°ì´í„°ë² ì´ìŠ¤ì˜ ëª¨ë“  ë°ì´í„°ë¥¼ ì¶”ì¶œ
- ì¶”ì¶œí•œ ë°ì´í„°ëŠ” json í˜•ì‹ìœ¼ë¡œ ì €ì¥

```bash
# ì‘ì„± ì˜ˆì‹œ

$ python manage.py dumpdata [app_name[.ModelName] [app_name[.ModelName] ...]]> filename.json
```

```bash
# ì‹¤ì œ ì‘ì„± ì˜ˆì‹œ

$ python manage.py dumpdata --indent 4 articles.article > articles.json
$ python manage.py dumpdata --indent 4 accounts.user > users.json
$ python manage.py dumpdata --indent 4 articles.comment > comments.json
```

`loaddata`

- Fixtures ë°ì´í„°ë¥¼ ë°ì´í„°ë² ì´ìŠ¤ë¡œ ë¶ˆëŸ¬ì˜¤ê¸°
- Fixtures íŒŒì¼ ê¸°ë³¸ ê²½ë¡œ
    - app_name/fixtures
    - DjangoëŠ” ì„¤ì¹˜ëœ ëª¨ë“  appì˜ ë””ë ‰í† ë¦¬ì—ì„œ fixtures í´ë” ì´í›„ì˜ ê²½ë¡œë¡œ fixtures íŒŒì¼ì„ ì°¾ì•„ load
- í™œìš© ì˜ˆì‹œ
    - db.sqlite3 íŒŒì¼ ì‚­ì œ í›„ migrate ì§„í–‰
    - app_name/fixturesì— fixture íŒŒì¼ ì´ë™
    - ë°ì´í„° load
        
        ```bash
        $ python manage.py loaddata articles.json users.json comments.json
        ```
        
        - ë§Œì•½ loaddataë¥¼ í•œë²ˆì— ì‹¤í–‰í•˜ì§€ ì•Šê³  í•˜ë‚˜ ì”© ì‹¤í–‰í•œë‹¤ë©´ ëª¨ë¸ ê´€ê³„ì— ë”°ë¼ loadí•˜ëŠ” ìˆœì„œê°€ ì¤‘ìš”
            - commentëŠ” articleì— ëŒ€í•œ key ë° userì— ëŒ€í•œ keyê°€ í•„ìš”
            - articleì€ userì— ëŒ€í•œ key í•„ìš”
        - ì¦‰, í˜„ì¬ ëª¨ë¸ ê´€ê³„ì—ì„œëŠ” user â†’ article â†’ comment ìˆœìœ¼ë¡œ dataë¥¼ ë„£ì–´ì•¼ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ì§€ ì•ŠìŒ
- **Fixtures íŒŒì¼ì„ ì§ì ‘ ë§Œë“¤ì§€ ë§ ê²ƒ**

## ì¿¼ë¦¬ ê°œì„ (Improve query)

- ê°™ì€ ê²°ê³¼ë¥¼ ì–»ê¸° ìœ„í•´ DB ì¸¡ì— ë³´ë‚´ëŠ” ì¿¼ë¦¬ ê°œìˆ˜ë¥¼ ì ì°¨ ì¤„ì—¬ ì¡°íšŒí•˜ê¸°

### ì‚¬ì „ ì¤€ë¹„

- fixtures íŒŒì¼ load data

```bash
$ python manage.py loaddata users.json articles.json comments.json
```

### annotate

- SQLì˜ GROUP BY ì¿¼ë¦¬ë¥¼ ì‚¬ìš©
- ê²Œì‹œê¸€ì„ ì¡°íšŒí•˜ë©´ì„œ ëŒ“ê¸€ ê°œìˆ˜ê¹Œì§€ í•œë²ˆì— ì¡°íšŒí•´ì„œ ê°€ì ¸ì˜¤ê¸°

```python
# views.py

def index_1(request):
    # articles = Article.objects.order_by('-pk')
    articles = Article.objects.annotate(Count('comment')).order_by('-pk')
    context = {
        'articles': articles,
    }
    return render(request, 'articles/index_1.html', context)
```

```html
<h1>Articles</h1>
{% for article in articles %}
  <p>ì œëª© : {{ article.title }}</p>
  {% comment %} <p>ëŒ“ê¸€ê°œìˆ˜ : {{ article.comment_set.count }}</p> {% endcomment %}
  <p>ëŒ“ê¸€ê°œìˆ˜ : {{ article.comment__count }}</p>
  <hr>
{% endfor %}
```

### select_related

- SQLì˜ INNER JOINì¿¼ë¦¬ë¥¼ í™œìš©
- 1:1 ë˜ëŠ” N:1 ì°¸ì¡° ê´€ê³„ì—ì„œ ì‚¬ìš©
- ê²Œì‹œê¸€ì„ ì¡°íšŒí•˜ë©´ì„œ ìœ ì € ì •ë³´ê¹Œì§€ í•œë²ˆì— ì¡°íšŒí•´ì„œ ê°€ì ¸ì˜¤ê¸°

```python
# views.py

def index_2(request):
    # articles = Article.objects.order_by('-pk')
    articles = Article.objects.select_related('user').order_by('-pk')
    context = {
        'articles': articles,
    }
    return render(request, 'articles/index_2.html', context)
```

### prefetch_related

- M:N ë˜ëŠ” N:1 ì—­ì°¸ì¡° ê´€ê³„ì—ì„œ ì‚¬ìš©
- SQLì´ ì•„ë‹Œ Pythonì„ ì‚¬ìš©í•œ JOINì„ ì§„í–‰
- ê²Œì‹œê¸€ì„ ì¡°íšŒí•˜ë©´ì„œ ì°¸ì¡°ëœ ëŒ“ê¸€ê¹Œì§€ í•œë²ˆì— ì¡°íšŒ

```python
def index_3(request):
    # articles = Article.objects.order_by('-pk')
    articles = Article.objects.prefetch_related('comment_set').order_by('-pk')
    context = {
        'articles': articles,
    }
    return render(request, 'articles/index_3.html', context)def index_3(request):
    # articles = Article.objects.order_by('-pk')
    articles = Article.objects.prefetch_related('comment_set').order_by('-pk')
    context = {
        'articles': articles,
    }
    return render(request, 'articles/index_3.html', context)def index_3(request):
    # articles = Article.objects.order_by('-pk')
    articles = Article.objects.prefetch_related('comment_set').order_by('-pk')
    context = {
        'articles': articles,
    }
    return render(request, 'articles/index_3.html', context)
```

### select_related & prefetch_related

- ê²Œì‹œê¸€ì„ ì¡°íšŒí•˜ë©´ì„œ ì°¸ì¡°ëœ ëŒ“ê¸€ ëª©ë¡, ëŒ“ê¸€ ì‘ì„±ìê¹Œì§€ í•œë²ˆì— ì¡°íšŒ

```python
def index_4(request):
    # articles = Article.objects.order_by('-pk')
    # articles = Article.objects.prefetch_related('comment_set').order_by('-pk')
    articles = Article.objects.prefetch_related(
        Prefetch('comment_set', queryset=Comment.objects.select_related('user'))
    ).order_by('-pk')

    context = {
        'articles': articles,
    }
    return render(request, 'articles/index_4.html', context)
```

### ì¿¼ë¦¬ ê°œì„  ì£¼ì˜ì‚¬í•­

- **ì„£ë¶€ë¥¸ ìµœì í™”ëŠ” ì§€ì–‘í•´ì•¼ í•œë‹¤**

## ì°¸ê³ 

### íƒ€ì… ì„ í˜¸ë„(Type Affinity)

- ì»¬ëŸ¼ì— ë°ì´í„° íƒ€ì…ì´ ëª…ì‹œì ìœ¼ë¡œ ì§€ì •ë˜ì§€ ì•Šì•˜ê±°ë‚˜ ì§€ì›í•˜ì§€ ì•Šì„ ë•Œ SQLiteê°€ ìë™ìœ¼ë¡œ ë°ì´í„° íƒ€ì…ì„ ì¶”ë¡ í•˜ëŠ” ê²ƒ
    - [https://www.sqlite.org/datatype3.html](https://www.sqlite.org/datatype3.html)
- íƒ€ì… ì„ í˜¸ë„ ëª©ì 
    - ìœ ì—°í•œ ë°ì´í„° íƒ€ì… ì§€ì›
        - ë°ì´í„° íƒ€ì…ì„ ëª…ì‹œì ìœ¼ë¡œ ì§€ì •í•˜ì§€ ì•Šê³ ë„ ë°ì´í„°ë¥¼ ì €ì¥í•˜ê³  ì¡°íšŒí•  ìˆ˜ ìˆìŒ
        - ì»¬ëŸ¼ì— ì €ì¥ë˜ëŠ” ê°’ì˜ íŠ¹ì„±ì„ ê¸°ë°˜ìœ¼ë¡œ ë°ì´í„° íƒ€ì…ì„ ìœ ì¶”
    - ê°„í¸í•œ ë°ì´í„° ì²˜ë¦¬
        - INTEGER Type Affinityë¥¼ ê°€ì§„ ì—´ì— ë¬¸ìì—´ ë°ì´í„°ë¥¼ ì €ì¥í•´ë„ SQLiteëŠ” ìë™ìœ¼ë¡œ ìˆ«ìë¡œ ë³€í™˜í•˜ì—¬ ì²˜ë¦¬
    - SQL í˜¸í™˜ì„±
        - ë‹¤ë¥¸ ë°ì´í„°ë² ì´ìŠ¤ ì‹œìŠ¤í…œê³¼ í˜¸í™˜ì„±ì„ ìœ ì§€

### ë°˜ë“œì‹œ NOT NULL ì œì•½ì„ ì‚¬ìš©í•´ì•¼ í•˜ëŠ”ê°€?

- ë°˜ë“œì‹œëŠ” ì•„ë‹˜
- í•˜ì§€ë§Œ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì‚¬ìš©í•˜ëŠ” í”„ë¡œê·¸ë¨ì— ë”°ë¼ NULLì„ ì €ì¥í•  í•„ìš”ê°€ ì—†ëŠ” ê²½ìš°ê°€ ë§ìœ¼ë¯€ë¡œ ëŒ€ë¶€ë¶„ NOT NULLì„ ì •ì˜
- â€œê°’ì´ ì—†ë‹¤â€ ë¼ëŠ” í‘œí˜„ì„ í…Œì´ë¸”ì— ê¸°ë¡í•˜ëŠ” ê²ƒì„ â€˜0â€™ì´ë‚˜ â€˜ë¹ˆ ë¬¸ìì—´â€™ ë“±ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒìœ¼ë¡œ ëŒ€ì²´í•˜ëŠ” ê²ƒì„ ê¶Œì¥

### SQLiteì˜ ë‚ ì§œì™€ ì‹œê°„

- SQLiteì—ëŠ” ë‚ ì§œ ë°/ë˜ëŠ” ì‹œê°„ì„ ì €ì¥í•˜ê¸° ìœ„í•œ ë³„ë„ ë°ì´í„° íƒ€ì…ì´ ì—†ìŒ
- ëŒ€ì‹  ë‚ ì§œ ë° ì‹œê°„ì— ëŒ€í•œ í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•´ í‘œê¸° í˜•ì‹ì— ë”°ë¼ TEXT, REAL, INTEGER ê°’ìœ¼ë¡œ ì €ì¥
- [https://www.sqlite.org/datatype3.html](https://www.sqlite.org/datatype3.html)

### admin site ë“±ë¡

- Comment ëª¨ë¸ì„ admin siteì— ë“±ë¡í•´ CRUD ë™ì‘ í™•ì¸í•˜ê¸°

```python
# articles/admin.py

from .models import Article, Comment

admin.site.register(Article)
admin.site.register(Comment)
```

### ëŒ“ê¸€ì´ ì—†ëŠ” ê²½ìš° ëŒ€ì²´ ì½˜í…ì¸  ì¶œë ¥

- DTL â€˜for emptyâ€™ íƒœê·¸ ì‚¬ìš©

```html
<!-- articles/detail.html -->

<h4>ëŒ“ê¸€ ëª©ë¡</h4>
<ul>
  {% for comment in comments %}
    <li>
      {{ comment.content }}
      <form action="{% url "articles:comments_delete" article.pk comment.pk %}" method="POST">
        {% csrf_token %}
        <input type="submit" value="DELETE">
      </form>
    </li>
  {% empty %}
    <p>ëŒ“ê¸€ì´ ì—†ì–´ìš”</p>
  {% endfor %}
</ul>
```

### ëŒ“ê¸€ ê°œìˆ˜ ì¶œë ¥í•˜ê¸°

- DTL filter - â€˜lengthâ€™ ì‚¬ìš©

```html
{{ comments|length }}

{{ article.comment_set.all|length }}
```

- QuerysetAPI - â€˜count()â€™ ì‚¬ìš©

```html
{{ article.comment_set.count }}
```

### ì¸ì¦ëœ ì‚¬ìš©ìë§Œ ëŒ“ê¸€ ì‘ì„± ë° ì‚­ì œ

```python
# articles/views.py

@login_required
def comments_create(request, pk):
	pass

@login_required
def comments_delete(request, article_pk, comment_pk):
	pass
```

### .exists()

- QuerySetì— ê²°ê³¼ê°€ í¬í•¨ë˜ì–´ ìˆìœ¼ë©´ Trueë¥¼ ë°˜í™˜í•˜ê³  ê²°ê³¼ê°€ í¬í•¨ë˜ì–´ ìˆì§€ ì•Šìœ¼ë©´ Falseë¥¼ ë°˜í™˜
- í° QuerySetì— ìˆëŠ” íŠ¹ì • ê°ì²´ ê²€ìƒ‰ì— ìœ ìš©

```python
# articles/views.py

@login_required
def likes(request, article_pk):
    article = Article.objects.get(pk=article_pk)
    if article.like_users.filter(pk=request.user.pk).exists():
        article.like_users.remove(request.user)
    else:
        article.like_users.add(request.user)
    return redirect('articles:index')

# accounts/views.py

```

### ëª¨ë“  ëª¨ë¸ì„ í•œë²ˆì— dump í•˜ê¸°

```bash
# 3ê°œì˜ ëª¨ë¸ì„ í•˜ë‚˜ì˜ json íŒŒì¼ë¡œ
$ python manage.py dumpdata --indent 4 articles.article articles.comment accounts.user > data.json

# ëª¨ë“  ëª¨ë¸ì„ í•˜ë‚˜ì˜ json íŒŒì¼ë¡œ
$ python manage.py dumpdata --indent 4 > data.json
```

### loaddata ì‹œ encoding codec ê´€ë ¨ ì—ëŸ¬ê°€ ë°œìƒí•˜ëŠ” ê²½ìš°

1. dumpdata ì‹œ ì¶”ê°€ ì˜µì…˜ ì‘ì„±

```bash
$ python -Xutf8 manage.py dumpdata [ìƒëµ]
```

1. ë©”ëª¨ì¥ í™œìš©
    1. ë©”ëª¨ì¥ìœ¼ë¡œ json íŒŒì¼ ì—´ê¸°
    2. ë‹¤ë¥¸ ì´ë¦„ ì €ì¥ í´ë¦­
    3. ì¸ì½”ë”© UTF8ë¡œ ì„ íƒ í›„ ì €ì¥